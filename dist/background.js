chrome.runtime.onInstalled.addListener(()=>{console.log("AI Chat Manager extension installed."),s()});async function n(){var t,e;try{return((e=(t=(await chrome.storage.local.get(["appData"])).appData)==null?void 0:t.settings)==null?void 0:e.aiPlatforms)||[{id:"gemini",name:"Gemini",urlPattern:"https://gemini.google.com/",titlePrefix:"Gemini-",notePrefix:"Gemini chat for",isDefault:!0},{id:"chatgpt",name:"ChatGPT",urlPattern:"https://chatgpt.com/",titlePrefix:"ChatGPT-",notePrefix:"ChatGPT chat for",isDefault:!0},{id:"claude",name:"Claude",urlPattern:"https://claude.ai/",titlePrefix:"Claude-",notePrefix:"Claude chat for",isDefault:!0},{id:"perplexity",name:"Perplexity",urlPattern:"https://www.perplexity.ai/",titlePrefix:"Perplexity-",notePrefix:"Perplexity chat for",isDefault:!0}]}catch(r){return console.error("Error getting platform settings:",r),[]}}function c(t,e){return e.some(r=>t.startsWith(r.urlPattern))}async function i(t,e){try{const r=await n();c(e,r)&&(await chrome.scripting.executeScript({target:{tabId:t},files:["content.js"]}),console.log(`Content script injected into tab ${t}: ${e}`))}catch(r){console.error("Error injecting content script:",r)}}function s(){chrome.tabs.onUpdated.addListener(async(t,e,r)=>{e.status==="complete"&&r.url&&await i(t,r.url)}),chrome.tabs.query({},async t=>{for(const e of t)e.url&&!e.url.startsWith("chrome://")&&await i(e.id,e.url)})}chrome.runtime.onMessage.addListener(async(t,e,r)=>{if(console.log("Background received message:",t),t.action==="GET_PLATFORM_SETTINGS"){const a=await n();return r({platforms:a}),!0}if(t.action==="SAVE_CHAT_FROM_PAGE"){const a=t.chatData,o={id:`chat_${Date.now()}`,title:a.title,url:a.url,note:a.summary,collectionIds:[],createdAt:a.timestamp,isFavorite:!1,isDeleted:!1,platform:a.platform};return chrome.action.openPopup().then(()=>{setTimeout(()=>{chrome.runtime.sendMessage({action:"PREFILL_SAVE_DIALOG",chatData:o})},500)}),r({success:!0}),!0}if(t.action==="OPEN_MANAGER")return chrome.tabs.create({url:chrome.runtime.getURL("manager.html")}),r({success:!0}),!0});
