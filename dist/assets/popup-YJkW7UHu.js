import{c as X,r as l,j as e,B as R,I as B,P as W,L as T,R as H,a as G,b as V,C as L,d as M,e as Q,f as _,g as Y,h as q,s as Z,i as K,k as ee}from"./global-BjklyNvB.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=X("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);function te({onSave:w,onOpenManager:o,allCollections:P=[],currentTab:f,aiPlatforms:A=[],onCreateCollection:N}){const[c,y]=l.useState(""),[d,x]=l.useState(""),[u,m]=l.useState([]),[E,g]=l.useState(!1),[C,p]=l.useState(""),[F,z]=l.useState(!1),[k,D]=l.useState(!1);l.useEffect(()=>{if(!f||!f.url)return;const r=A.find(i=>f.url.startsWith(i.urlPattern));r&&(y(r.titlePrefix||""),x(r.notePrefix||""))},[f,A]);const $=async()=>{if(!c.trim()){alert("Please enter a title for the chat.");return}z(!0);try{const r={id:`chat_${Date.now()}`,title:c.trim(),url:f.url,note:d.trim(),collectionIds:u,createdAt:new Date().toISOString(),isFavorite:!1,isDeleted:!1};await w(r),y(""),x(""),m([]),g(!1),p("")}catch(r){console.error("Failed to save chat:",r),alert("Failed to save chat. Please try again.")}finally{z(!1)}},h=()=>{y(""),x(""),m([]),g(!1),p("")},b=async()=>{if(!C.trim()){alert("Please enter a collection name.");return}D(!0);try{if(N){const r=await N(C.trim());m(i=>[...i,r.id])}p(""),g(!1)}catch(r){alert(r.message||"Failed to create collection.")}finally{D(!1)}};return e.jsxs("div",{className:"px-4 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground bg-zinc-800/30 backdrop-blur-sm rounded-tl-lg rounded-tr-lg  pt-1 pb-1 pl-2 pr-4",children:"Save Chat"}),e.jsxs(R,{variant:"ghost",size:"sm",onClick:o,className:"px-2 pb-1 pt-1 flex items-center bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Manager"]})]}),e.jsx("div",{className:"max-w-sm mx-auto px-4 bg-zinc-800/30 backdrop-blur-sm rounded-tr-lg rounded-br-lg rounded-bl-lg",children:e.jsxs("div",{className:" p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block text-foreground",children:"Title"}),e.jsx(B,{value:c,onChange:r=>y(r.target.value),placeholder:"Enter chat title...",className:"w-full bg-black/30 border-gray-700 focus:bg-black/20 focus:border-gray-600 text-white placeholder:text-gray-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block text-foreground",children:"Note (optional)"}),e.jsx(B,{value:d,onChange:r=>x(r.target.value),placeholder:"Add a note...",className:"w-full bg-black/30 border-gray-700 focus:bg-black/20 focus:border-gray-600 text-white placeholder:text-gray-500"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Tags"}),e.jsxs(R,{variant:"ghost",size:"sm",onClick:()=>g(!E),className:"px-2 py-1 h-6 text-xs bg-green-600/20 hover:bg-green-600/30 text-green-400 border border-green-600/50",children:[e.jsx(W,{className:"h-3 w-3 mr-1"}),"Add New"]})]}),E&&e.jsxs("div",{className:"mb-2 flex space-x-2",children:[e.jsx(B,{value:C,onChange:r=>p(r.target.value),placeholder:"Enter collection name...",disabled:k,className:"flex-1 bg-black/30 border-gray-700 focus:bg-black/20 focus:border-gray-600 text-white placeholder:text-gray-500 text-sm",onKeyPress:r=>{r.key==="Enter"&&!k&&b()}}),e.jsx(R,{onClick:b,size:"sm",disabled:!C.trim()||k,className:"px-3 py-1 h-8 bg-green-600 hover:bg-green-700 text-white text-xs disabled:opacity-50 disabled:cursor-not-allowed",children:k?"Adding...":"Add"})]}),e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto custom-scrollbar",children:P.sort((r,i)=>r.isPinned&&!i.isPinned?-1:!r.isPinned&&i.isPinned?1:r.isFavorite&&!i.isFavorite?-1:!r.isFavorite&&i.isFavorite?1:r.name.localeCompare(i.name)).map(r=>e.jsx("div",{className:`p-2 rounded-md cursor-pointer transition-colors flex items-center justify-between select-none ${u.includes(r.id)?"bg-blue-500/20 border border-blue-500":"bg-secondary/50 hover:bg-secondary"}`,onClick:()=>{m(i=>i.includes(r.id)?i.filter(S=>S!==r.id):[...i,r.id])},children:e.jsxs("div",{className:"flex items-center space-x-3 select-none",children:[e.jsx("div",{className:`w-4 h-4 rounded border-2 flex items-center justify-center transition-colors cursor-pointer select-none ${u.includes(r.id)?"bg-blue-500 border-blue-500":"border-gray-400 bg-transparent"}`,children:u.includes(r.id)&&e.jsx("svg",{className:"w-2.5 h-2.5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"flex items-center space-x-2 select-none",children:[e.jsx("span",{className:"text-sm font-medium text-foreground select-none cursor-pointer",children:r.name}),(r.isPinned||r.isFavorite)&&e.jsxs("div",{className:"flex items-center space-x-1 select-none",children:[r.isPinned&&e.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full select-none",title:"Pinned"}),r.isFavorite&&e.jsx("div",{className:"w-1.5 h-1.5 bg-yellow-500 rounded-full select-none",title:"Favorite"})]})]})]})},r.id))})]}),e.jsxs("div",{className:"flex space-x-2 pt-2",children:[e.jsx(R,{variant:"outline",onClick:h,className:"flex-1 px-3 py-1.5 h-8 bg-black/30 border-gray-700 text-white hover:bg-black/20 text-sm",children:"Cancel"}),e.jsx(R,{onClick:$,disabled:F,className:"flex-1 px-3 py-1.5 h-8 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white text-sm",children:F?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-3.5 w-3.5 mr-1.5 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"h-3.5 w-3.5 mr-1.5"}),"Save Chat"]})})]})]})})]})}function se(){var O;const[w,o]=l.useState(!1),[P,f]=l.useState(!0),[A,N]=l.useState(null),[c,y]=l.useState(null),[d,x]=l.useState({collections:[]}),[u,m]=l.useState(null),E=l.useRef(null),g=l.useRef(null);l.useEffect(()=>{(async()=>{try{const s=await Y();o(s);const a=await chrome.tabs.query({active:!0,currentWindow:!0});if(!a||a.length===0)throw new Error("Could not get current tab information.");if(y(a[0]),s){const n=await q();x(n)}}catch(s){console.error("Popup initialization failed:",s),N(s.message||"An unknown error occurred.")}finally{f(!1)}})()},[]),l.useEffect(()=>{if(u){const t=E.current||g.current;if(t){const s=t.getBoundingClientRect(),a=window.innerHeight;s.bottom>a&&t.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})}}},[u]);const C=async()=>{try{await Z(),o(!0);const t=await q();x(t),N(null)}catch(t){console.error("Sign-in failed from popup:",t),N(t.message||"Sign-in failed or was cancelled.")}},p=()=>{chrome.tabs.create({url:chrome.runtime.getURL("manager.html")})},F=async t=>{const s={...d,chats:[...d.chats||[],t]};try{await K(s),window.close()}catch(a){console.error("Failed to save chat from popup:",a),alert("Error: Could not save the chat.")}},z=async t=>{if(d.collections.some(n=>!n.isDeleted&&n.name.toLowerCase()===t.toLowerCase()))throw new Error(`A collection named "${t}" already exists.`);const s={id:`col_${Date.now()}`,name:t,isPinned:!1,isFavorite:!1,isDeleted:!1,dateCreated:new Date().toISOString(),dateDeleted:null},a={...d,collections:[...d.collections,s].sort((n,I)=>n.name.localeCompare(I.name))};try{return await K(a),x(a),s}catch(n){throw console.error("Failed to create collection:",n),n}},k=(t,s=[])=>{if(!t)return!1;const a=["https://gemini.google.com/","https://chatgpt.com/","https://claude.ai/","https://www.perplexity.ai/"];return s.length>0?s.some(n=>t.startsWith(n.urlPattern)):a.some(n=>t.startsWith(n))},D=((O=d.settings)==null?void 0:O.aiPlatforms)||[],$=k(c==null?void 0:c.url,D),h=H.useMemo(()=>{var t,s,a;return((a=(s=(t=d.collections)==null?void 0:t.filter(n=>!n.isDeleted&&n.isPinned))==null?void 0:s.sort((n,I)=>new Date(I.dateCreated)-new Date(n.dateCreated)))==null?void 0:a.slice(0,3))||[]},[d.collections]),b=t=>{var s;return((s=d.chats)==null?void 0:s.filter(a=>!a.isDeleted&&a.collectionIds.includes(t)))||[]},r=t=>{if(c!=null&&c.url){const s=new URL(c.url),a=s.pathname.split("/"),n=a.findIndex(v=>v==="u");if(n!==-1&&a[n+1]){const v=a[n+1],U=new URL(t);let j=U.pathname;if(!j.includes("/u/"))return j.startsWith("/app/")?j=`/u/${v}${j}`:j=`/u/${v}${j}`,U.pathname=j,U.toString()}const I=s.searchParams.get("authuser");if(I){const v=new URL(t);return v.searchParams.set("authuser",I),v.toString()}}return t},i=t=>{const s=r(t);console.log("Original URL:",t),console.log("Current Tab URL:",c==null?void 0:c.url),console.log("Account-aware URL:",s),chrome.tabs.create({url:s}),window.close()},S="w-96 min-h-[200px] rounded-xl bg-background shadow-lg";return P?e.jsxs("div",{className:`${S} flex flex-col items-center justify-center p-6`,children:[e.jsx(T,{className:"h-8 w-8 animate-spin text-primary mb-3"}),e.jsx("div",{className:"text-foreground text-sm",children:"Loading AI Chat Manager..."})]}):A?e.jsx("div",{className:`${S} flex flex-col items-center justify-center p-6`,children:e.jsxs("div",{className:"text-red-500 text-sm text-center",children:[e.jsx("div",{className:"font-medium mb-2",children:"Error"}),e.jsx("div",{children:A})]})}):w?e.jsx("div",{className:S,children:$?e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(te,{onSave:F,onOpenManager:p,allCollections:d.collections.filter(t=>!t.isDeleted),currentTab:c,aiPlatforms:D,onCreateCollection:z,appData:d}),h.length>0&&e.jsxs("div",{className:"pt-2",children:[e.jsxs("h4",{className:"flex items-center justify-center gap-1 text-sm font-medium text-foreground mb-3",children:[e.jsx(V,{size:16,filled:!0,className:"text-blue-400"}),"Quick Access"]}),e.jsxs("div",{className:"flex justify-center gap-2 relative",onMouseLeave:()=>m(null),children:[h.map(t=>{const s=b(t.id),a=u===t.id;return e.jsxs(L,{className:"cursor-pointer hover:bg-accent/50 transition-colors w-24 h-16 flex-shrink-0 relative",onMouseEnter:()=>m(t.id),children:[e.jsxs(M,{className:"p-2 h-full flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-xs font-medium text-foreground truncate w-full text-center",children:t.name}),e.jsx(Q,{variant:"secondary",className:"text-[10px] px-1 py-0 mt-1",children:s.length})]}),a&&s.length>0&&e.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1/2",children:e.jsx(_,{className:"w-3 h-3 text-foreground bg-background rounded-full border border-border"})})]},t.id)}),u&&(()=>{const t=h.find(a=>a.id===u),s=t?b(t.id):[];return s.length>0&&e.jsx("div",{ref:E,className:"absolute top-full left-1/2 transform -translate-x-1/2 z-50 pt-2 w-72",onMouseEnter:()=>m(t.id),children:e.jsx(L,{className:"max-h-64 overflow-y-auto shadow-lg border",children:e.jsxs(M,{className:"p-2",children:[s.slice(0,10).map(a=>e.jsx("div",{className:"px-2 py-1 text-xs text-foreground hover:bg-accent rounded cursor-pointer truncate text-center",onClick:n=>{n.stopPropagation(),i(a.url)},title:`Click to open: ${a.title}`,children:a.title},a.id)),s.length>10&&e.jsxs("div",{className:"px-2 py-1 text-xs text-muted-foreground font-medium text-center",children:["+",s.length-10," more chats..."]})]})})})})()]})]})]}):e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-3",children:"AI Chat Manager"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Navigate to an AI chat page to save it."}),e.jsx("p",{className:"text-xs text-muted-foreground mb-4",children:"Supports: Gemini, ChatGPT, Claude, Perplexity"}),e.jsx("div",{className:"mb-6 flex justify-center",children:e.jsxs(G,{variant:"ghost",size:"sm",onClick:p,className:"px-2 pb-1 pt-1 flex items-center bg-blue-600 hover:bg-blue-700 text-white text-sm",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Manager"]})}),h.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"flex items-center justify-center gap-1 text-sm font-medium text-foreground mb-3",children:[e.jsx(V,{size:16,filled:!0,className:"text-blue-400"}),"Quick Access"]}),e.jsxs("div",{className:"flex justify-center gap-2 relative",onMouseLeave:()=>m(null),children:[h.map(t=>{const s=b(t.id),a=u===t.id;return e.jsxs(L,{className:"cursor-pointer hover:bg-accent/50 transition-colors w-24 h-16 flex-shrink-0 relative",onMouseEnter:()=>m(t.id),children:[e.jsxs(M,{className:"p-2 h-full flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-xs font-medium text-foreground truncate w-full text-center",children:t.name}),e.jsx(Q,{variant:"secondary",className:"text-[10px] px-1 py-0 mt-1",children:s.length})]}),a&&s.length>0&&e.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1/2",children:e.jsx(_,{className:"w-3 h-3 text-foreground bg-background rounded-full border border-border"})})]},t.id)}),u&&(()=>{const t=h.find(a=>a.id===u),s=t?b(t.id):[];return s.length>0&&e.jsx("div",{ref:g,className:"absolute top-full left-1/2 transform -translate-x-1/2 z-50 pt-2 w-72",onMouseEnter:()=>m(t.id),children:e.jsx(L,{className:"max-h-64 overflow-y-auto shadow-lg border",children:e.jsxs(M,{className:"p-2",children:[s.slice(0,10).map(a=>e.jsx("div",{className:"px-2 py-1 text-xs text-foreground hover:bg-accent rounded cursor-pointer truncate text-center",onClick:n=>{n.stopPropagation(),i(a.url)},title:`Click to open: ${a.title}`,children:a.title},a.id)),s.length>10&&e.jsxs("div",{className:"px-2 py-1 text-xs text-muted-foreground font-medium text-center",children:["+",s.length-10," more chats..."]})]})})})})()]})]})]})}):e.jsxs("div",{className:`${S} flex flex-col items-center justify-center p-6 text-center`,children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-3",children:"AI Chat Manager"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Please sign in to save and organize your AI chats."}),e.jsx(G,{onClick:C,className:"w-full",children:"Sign In with Google"})]})}class re extends H.Component{constructor(o){super(o),this.state={hasError:!1,error:null}}static getDerivedStateFromError(o){return{hasError:!0,error:o}}componentDidCatch(o,P){console.error("Error caught by boundary:",o,P)}render(){var o;return this.state.hasError?e.jsx("div",{className:"w-96 min-h-[200px] rounded-xl bg-background shadow-lg p-6 text-center",children:e.jsxs("div",{className:"text-red-500 text-sm",children:[e.jsx("div",{className:"font-medium mb-2",children:"Something went wrong"}),e.jsx("div",{className:"text-xs mb-4",children:((o=this.state.error)==null?void 0:o.message)||"An unexpected error occurred"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-primary text-primary-foreground rounded text-xs hover:bg-primary/90",children:"Refresh"})]})}):this.props.children}}function ae(){return e.jsx(re,{children:e.jsx(se,{})})}document.documentElement.classList.add("dark");try{console.log("Initializing React app..."),ee.createRoot(document.getElementById("root")).render(e.jsx(H.StrictMode,{children:e.jsx(ae,{})})),console.log("React app initialized successfully")}catch(w){console.error("Failed to initialize React app:",w);const o=document.getElementById("root");o&&(o.innerHTML=`
      <div style="
        width: 384px; 
        min-height: 200px; 
        padding: 24px; 
        background: #1f2937; 
        color: #f9fafb; 
        border-radius: 12px; 
        text-align: center;
        font-family: system-ui, -apple-system, sans-serif;
      ">
        <h3 style="color: #ef4444; margin-bottom: 16px;">Initialization Error</h3>
        <p style="font-size: 14px; margin-bottom: 16px;">Failed to load the extension</p>
        <button onclick="window.location.reload()" style="
          padding: 8px 16px; 
          background: #3b82f6; 
          color: white; 
          border: none; 
          border-radius: 6px; 
          cursor: pointer;
        ">
          Refresh
        </button>
      </div>
    `)}
