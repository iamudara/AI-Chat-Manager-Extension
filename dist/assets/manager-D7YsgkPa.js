import{c as z,r as x,i as je,h as Ce,j as e,X as Ne,C as ae,l as L,d as le,B as P,b as ne,e as O,S as ie,m as oe,n as ce,o as de,p as G,a as T,P as K,I as B,D as $,q as V,t as _,u as q,v as H,w as we,L as se,k as ke,R as Pe}from"./global-BjklyNvB.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=z("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=z("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=z("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=z("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=z("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=z("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=z("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=z("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=z("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=z("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=z("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=z("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);function De(){const[t,r]=x.useState({chats:[],collections:[],settings:{}}),[a,n]=x.useState(!0),[u,c]=x.useState(null);x.useEffect(()=>{(async()=>{try{const h=await Ce();r(h)}catch(h){console.error("Failed to load data:",h),c(h.message)}finally{n(!1)}})()},[]);const i=x.useCallback(async p=>{const h=t;r(p);try{await je(p)}catch(v){throw console.error("Failed to save data:",v),r(h),new Error("Could not save your changes.")}},[t]);return{appData:t,isLoading:a,error:u,updateAppData:i,setAppData:r}}function Ae(){const[t,r]=x.useState("collections"),[a,n]=x.useState([]),[u,c]=x.useState("Collections"),[i,p]=x.useState(""),[h,v]=x.useState(!1),[N,o]=x.useState({createCollection:!1,editCollection:null,editChat:null,confirm:null}),[l,m]=x.useState(null),[j,y]=x.useState(!1),[b,s]=x.useState(null),[d,g]=x.useState(null),[f,w]=x.useState(null),E=x.useCallback((M,D=null)=>{o(W=>({...W,[M]:D||!0}))},[]),F=x.useCallback(M=>{o(D=>({...D,[M]:null}))},[]),S=x.useCallback((M,D)=>{m({title:M,message:D})},[]);return{currentView:t,setCurrentView:r,filteredChats:a,setFilteredChats:n,viewTitle:u,setViewTitle:c,searchQuery:i,setSearchQuery:p,isSearchFocused:h,setIsSearchFocused:v,modals:N,setModals:o,alertModal:l,setAlertModal:m,isProcessing:j,setIsProcessing:y,itemToDelete:b,setItemToDelete:s,chatToEdit:d,setChatToEdit:g,collectionToEdit:f,setCollectionToEdit:w,openModal:E,closeModal:F,showAlert:S}}function ue(t){return[...t].sort((r,a)=>r.isPinned!==a.isPinned?a.isPinned-r.isPinned:r.isFavorite!==a.isFavorite?a.isFavorite-r.isFavorite:r.name.localeCompare(a.name))}function A(t){return[...t].sort((r,a)=>{if(r.isFavorite!==a.isFavorite)return a.isFavorite-r.isFavorite;const n=new Date(r.dateModified||r.createdAt||0);return new Date(a.dateModified||a.createdAt||0)-n})}function Oe(t,r,a,n,u){const c=x.useCallback(o=>{let l=[],m="";const j={favorites:()=>{m="Favorites",l=t.chats.filter(s=>s.isFavorite&&!s.isDeleted)},trash:()=>{m="Trash",l=t.chats.filter(s=>s.isDeleted)},settings:()=>({view:"settings",title:"Settings"}),default:()=>{const s=t.collections.find(d=>d.id===o);s&&(m=`Tag: ${s.name}`,l=t.chats.filter(d=>d.collectionIds.includes(o)&&!d.isDeleted))}};return(j[o]||j.default)()||{chats:l,title:m,view:"allChats"}},[t.chats,t.collections]),i=x.useCallback(async o=>{try{if(t.collections.some(j=>!j.isDeleted&&j.name.toLowerCase()===o.toLowerCase()))throw new Error(`A tag named "${o}" already exists.`);const l={id:`col_${Date.now()}`,name:o,isPinned:!1,isFavorite:!1,isDeleted:!1,dateCreated:new Date().toISOString(),dateDeleted:null},m={...t,collections:ue([...t.collections,l])};return await r(m),u("createCollection"),l}catch(l){throw console.error("Failed to create collection:",l),l}},[t,r,u]),p=x.useCallback(async o=>{try{const l={...t,collections:t.collections.map(m=>m.id===o?{...m,isFavorite:!m.isFavorite}:m)};await r(l)}catch(l){console.error("Failed to toggle favorite collection:",l),a("Error","Failed to update tag. Please try again.")}},[t,r,a]),h=x.useCallback(async o=>{try{const l=t.collections.filter(y=>y.isPinned&&!y.isDeleted).length;if(!t.collections.find(y=>y.id===o).isPinned&&l>=3){a("Pin Limit Reached","You can only pin up to 3 tags for Quick Access. Please unpin another tag first.");return}const j={...t,collections:t.collections.map(y=>y.id===o?{...y,isPinned:!y.isPinned}:y)};await r(j)}catch(l){console.error("Failed to toggle pin collection:",l),a("Error","Failed to update tag. Please try again.")}},[t,r,a]),v=x.useCallback(async o=>{try{if(t.collections.find(j=>!j.isDeleted&&j.id!==o.id&&j.name.toLowerCase()===o.name.toLowerCase()))throw new Error(`A tag named "${o.name}" already exists.`);const m={...t,collections:t.collections.map(j=>j.id===o.id?{...j,...o,dateModified:new Date().toISOString()}:j)};await r(m),u("editCollection")}catch(l){throw console.error("Failed to edit collection:",l),l}},[t,r,u]),N=x.useCallback(async o=>{try{const l={...t,collections:t.collections.map(m=>m.id===o?{...m,isDeleted:!0,dateDeleted:new Date().toISOString()}:m)};await r(l),u("confirm"),a("Success","Tag deleted.")}catch(l){console.error("Failed to delete tag:",l),a("Error","Failed to delete tag. Please try again.")}},[t,r,u,a]);return{handleSelectCollection:c,handleCreateCollection:i,handleEditCollection:v,handleToggleFavoriteCollection:p,handleTogglePinCollection:h,handleDeleteCollection:N}}function Be(t,r,a,n,u,c,i){const p=x.useCallback(y=>{const b=t.chats.find(s=>s.id===y);b&&n("editChat",b)},[t.chats,n]),h=x.useCallback(async y=>{try{const b={...y,dateModified:new Date().toISOString()},s=t.chats.map(d=>d.id===y.id?b:d);await r({...t,chats:s}),u("editChat"),c(d=>{const g=d.map(f=>f.id===y.id?b:f);return A(g)})}catch(b){console.error("Failed to save chat changes:",b),a("Error","Failed to save changes. Please try again.")}},[t,r,u,c,a]),v=x.useCallback(async y=>{try{let b;const s=t.chats.map(d=>d.id===y?(b={...d,isFavorite:!d.isFavorite},b):d);c(d=>{const g=d.map(f=>f.id===y?b:f);return A(g)}),await r({...t,chats:s})}catch(b){console.error("Failed to toggle favorite:",b),a("Error","Failed to update chat. Please try again.")}},[t,r,c,a]),N=x.useCallback(y=>{y&&window.open(y,"_blank")},[]),o=x.useCallback(async y=>{try{const b=t.chats.map(s=>s.id===y?{...s,isDeleted:!0,dateDeleted:new Date().toISOString()}:s);await r({...t,chats:b}),c(s=>{const d=s.map(g=>g.id===y?{...g,isDeleted:!0,dateDeleted:new Date().toISOString()}:g);return A(d)}),a("Success","Chat moved to trash.")}catch(b){console.error("Failed to delete chat:",b),a("Error","Failed to delete chat. Please try again.")}},[t,r,c,a]),l=x.useCallback(async y=>{try{const b=t.chats.map(s=>s.id===y?{...s,isDeleted:!1,dateDeleted:null}:s);await r({...t,chats:b}),c(s=>s.filter(d=>d.id!==y)),a("Success","Chat restored successfully.")}catch(b){console.error("Failed to restore chat:",b),a("Error","Failed to restore chat. Please try again.")}},[t,r,c,a]),m=x.useCallback(async y=>{try{const b=t.chats.filter(s=>s.id!==y);await r({...t,chats:b}),c(s=>s.filter(d=>d.id!==y)),a("Success","Chat permanently deleted.")}catch(b){console.error("Failed to permanently delete chat:",b),a("Error","Failed to permanently delete chat. Please try again.")}},[t,r,c,a]),j=x.useCallback(async(y,b)=>{i&&i(!0);try{let s=[...t.chats],d="";switch(y){case"favorite":s=s.map(g=>b.includes(g.id)?{...g,isFavorite:!0}:g),d=`${b.length} item(s) marked as favorite.`;break;case"trash":s=s.map(g=>b.includes(g.id)?{...g,isDeleted:!0,dateDeleted:new Date().toISOString()}:g),d=`${b.length} item(s) moved to trash.`;break;case"restore":s=s.map(g=>b.includes(g.id)?{...g,isDeleted:!1,dateDeleted:null}:g),d=`${b.length} item(s) restored.`;break;case"delete_permanently":s=s.filter(g=>!b.includes(g.id)),d=`${b.length} item(s) permanently deleted.`;break;default:i&&i(!1);return}await r({...t,chats:A(s)}),y==="trash"||y==="restore"||y==="delete_permanently"?c(g=>g.filter(f=>!b.includes(f.id))):y==="favorite"&&c(g=>A(g.map(f=>b.includes(f.id)?{...f,isFavorite:!0}:f))),i&&i(!1),a("Success",d)}catch(s){console.error("Failed to perform bulk action:",s),i&&i(!1),a("Error","Failed to perform bulk action. Please try again.")}},[t,r,c,a,i]);return{handleEditChat:p,handleSaveChatChanges:h,handleToggleFavorite:v,handleOpenChat:N,handleDeleteChat:o,handleRestoreChat:l,handleDeleteChatPermanently:m,handleBulkAction:j}}function Re(t,r){let a;return function(...u){const c=()=>{clearTimeout(a),t(...u)};clearTimeout(a),a=setTimeout(c,r)}}function $e({onSearch:t,isSearchFocused:r,onFocusChange:a,onMobileMenuClick:n}){return e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-6 mt-6",children:[e.jsx("button",{onClick:n,className:"md:hidden p-2 hover:bg-secondary rounded-lg transition-colors flex-shrink-0",children:e.jsx(Te,{className:"w-5 h-5 text-foreground"})}),e.jsxs("div",{className:`relative transition-all duration-500 ease-in-out ${r?"w-[calc(100%-5rem)] md:w-[700px]":"w-[calc(100%-5rem)] md:w-[600px]"}`,children:[e.jsx(Ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Search Tags, chats, and settings...",onChange:u=>t(u.target.value),onFocus:()=>a(!0),onBlur:()=>a(!1),className:`w-full pl-10 pr-4 py-2 bg-secondary/50 border border-border rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-500 ease-in-out ${r?"py-3":"py-2"}`})]})]})}function Ve({currentView:t,onViewChange:r,onSelectCollection:a,viewTitle:n,isMobileOpen:u,onMobileClose:c}){const i=p=>{p(),c&&c()};return e.jsxs(e.Fragment,{children:[u&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 md:hidden",onClick:c}),e.jsx("nav",{className:`
        fixed md:static
        w-64 h-full
        bg-secondary/50 md:bg-secondary/50
        backdrop-blur-xl md:backdrop-blur-none
        border-r border-border/50 md:border-r-0
        shadow-2xl md:shadow-none
        overflow-y-auto custom-scrollbar
        z-50
        transition-transform duration-300 ease-in-out
        ${u?"translate-x-0":"-translate-x-full md:translate-x-0"}
      `,children:e.jsxs("div",{className:"p-4 space-y-1 mt-16 md:mt-24",children:[e.jsx("button",{onClick:c,className:"md:hidden absolute top-4 right-4 p-2 hover:bg-secondary rounded-lg transition-colors z-10",children:e.jsx(Ne,{className:"w-5 h-5 text-foreground"})}),e.jsx("button",{onClick:()=>i(()=>r("collections")),className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors ${t==="collections"?"bg-primary text-primary-foreground":"hover:bg-secondary text-foreground"}`,children:"Tags"}),e.jsx("button",{onClick:()=>i(()=>r("allChats")),className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors ${t==="allChats"&&n==="All Chats"?"bg-primary text-primary-foreground":"hover:bg-secondary text-foreground"}`,children:"All Chats"}),e.jsxs("div",{className:"pt-4",children:[e.jsx("div",{className:"px-3 py-2 text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Static Folders"}),e.jsxs("button",{onClick:()=>i(()=>a("favorites")),className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors flex items-center ${n==="Favorites"?"bg-primary text-primary-foreground":"hover:bg-secondary text-foreground"}`,children:[e.jsx(Q,{className:"w-4 h-4 mr-3 text-yellow-500"}),"Favorites"]}),e.jsxs("button",{onClick:()=>i(()=>a("trash")),className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors flex items-center ${n==="Trash"?"bg-primary text-primary-foreground":"hover:bg-secondary text-foreground"}`,children:[e.jsx(R,{className:"w-4 h-4 mr-3 text-red-500"}),"Trash"]})]}),e.jsx("div",{className:"pt-4 border-t border-border",children:e.jsxs("button",{onClick:()=>i(()=>r("settings")),className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors flex items-center ${t==="settings"?"bg-primary text-primary-foreground":"hover:bg-secondary text-foreground"}`,children:[e.jsx(Le,{className:"w-4 h-4 mr-3"}),"Settings"]})})]})})]})}function _e({collection:t,chatCount:r,onSelect:a,onEdit:n,onDelete:u,onToggleFavorite:c,onTogglePin:i}){const p=t.name.includes("/"),h=p?t.name.split("/")[1]:t.name,v=m=>{m.stopPropagation(),n(t.id)},N=m=>{m.stopPropagation(),u(t.id)},o=m=>{m.stopPropagation(),c&&c(t.id)},l=m=>{m.stopPropagation(),i&&i(t.id)};return e.jsx(ae,{className:L("group cursor-pointer hover:bg-gray-700/40 hover:border-gray-600 transition-all duration-200 mb-2",p&&"ml-6"),onClick:()=>a(t.id),children:e.jsx(le,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx(Me,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-foreground truncate text-base",children:h})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[i&&e.jsx(P,{variant:"ghost",size:"sm",onClick:l,className:L("h-7 w-7 p-0 transition-opacity",t.isPinned?"text-blue-500 hover:text-blue-600 opacity-100":"text-gray-400 hover:text-blue-500 opacity-0 group-hover:opacity-100"),title:t.isPinned?"Unpin collection":"Pin collection",children:e.jsx(ne,{size:16,filled:t.isPinned})}),c&&e.jsx(P,{variant:"ghost",size:"sm",onClick:o,className:L("h-7 w-7 p-0 transition-opacity",t.isFavorite?"text-yellow-500 hover:text-yellow-600 opacity-100":"text-gray-400 hover:text-yellow-500 opacity-0 group-hover:opacity-100"),title:t.isFavorite?"Remove from favorites":"Add to favorites",children:e.jsx(Q,{className:L("h-4 w-4",t.isFavorite&&"fill-current")})}),e.jsxs(O,{variant:"secondary",className:"text-xs",children:[r," chats"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(P,{variant:"ghost",size:"sm",onClick:v,className:"h-7 w-7 p-0 text-gray-400 hover:text-blue-500 hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity",title:"Edit collection",children:e.jsx(U,{className:"h-4 w-4"})}),e.jsx(P,{variant:"ghost",size:"sm",onClick:N,className:"h-7 w-7 p-0 text-gray-400 hover:text-red-500 hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity",title:"Delete collection",children:e.jsx(R,{className:"h-4 w-4"})})]})]})]})})})}function qe({collections:t=[],chats:r=[],onSelectCollection:a,onCreateCollection:n,onEditCollection:u,onDeleteCollection:c,onToggleFavoriteCollection:i,onTogglePinCollection:p}){const[h,v]=x.useState("name"),N=x.useMemo(()=>{const l={};return Array.isArray(r)&&r.forEach(m=>{m&&!m.isDeleted&&Array.isArray(m.collectionIds)&&m.collectionIds.forEach(j=>{j&&(l[j]=(l[j]||0)+1)})}),l},[r]),o=x.useMemo(()=>Array.isArray(t)?[...t].sort((l,m)=>{if(l.isPinned!==m.isPinned)return m.isPinned-l.isPinned;if(l.isPinned&&m.isPinned&&l.isFavorite!==m.isFavorite||!l.isPinned&&!m.isPinned&&l.isFavorite!==m.isFavorite)return m.isFavorite-l.isFavorite;if(h==="name")return l.name.localeCompare(m.name);if(h==="modified"){const j=d=>{const g=[d.modifiedAt,d.updatedAt,d.createdAt,d.dateCreated,d.timestamp];for(const f of g)if(f){const w=new Date(f);if(!isNaN(w.getTime()))return w}return new Date(0)},y=j(l),s=j(m)-y;if(s===0){const d=String(l.modifiedAt||l.updatedAt||l.createdAt||l.dateCreated||l.id||"");return String(m.modifiedAt||m.updatedAt||m.createdAt||m.dateCreated||m.id||"").localeCompare(d)}return s}return 0}):[],[t,h]);return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 p-3 md:p-4 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 flex-wrap",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-foreground",children:"Tags"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{size:16,className:"text-muted-foreground hidden sm:inline"}),e.jsxs(ie,{value:h,onValueChange:v,children:[e.jsx(oe,{className:"w-[120px] sm:w-[140px] h-8 text-xs sm:text-sm bg-secondary/50 border-border rounded-full",children:e.jsx(ce,{placeholder:"Sort by..."})}),e.jsxs(de,{children:[e.jsx(G,{value:"name",children:"By Name"}),e.jsx(G,{value:"modified",children:"By Modified"})]})]})]})]}),e.jsxs(T,{onClick:n,className:"flex items-center gap-2 text-xs sm:text-sm px-3 sm:px-4 py-2 w-full sm:w-auto",children:[e.jsx(K,{size:14,className:"sm:w-4 sm:h-4"})," Create New Tag"]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4 space-y-2 custom-scrollbar",children:o.map(l=>e.jsx(_e,{collection:l,chatCount:N[l.id]||0,onSelect:a,onEdit:u,onDelete:c,onToggleFavorite:i,onTogglePin:p},l.id))})]})}function He({chat:t,collections:r=[],onEdit:a,onToggleFavorite:n,onOpenChat:u,isSelected:c,onToggleSelection:i}){const p=o=>{o.stopPropagation(),a(t.id)},h=o=>{o.stopPropagation(),n(t.id)},v=o=>{o.stopPropagation(),u(t.url)},N=r.filter(o=>{var l;return(l=t.collectionIds)==null?void 0:l.includes(o.id)});return e.jsx(ae,{className:"group hover:bg-gray-700/40 hover:border-gray-600 transition-all duration-200 mb-2",children:e.jsx(le,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:L("w-4 h-4 rounded border-2 flex items-center justify-center transition-colors cursor-pointer mt-1",c?"bg-blue-600 border-blue-600":"border-gray-400 hover:border-gray-300"),onClick:o=>{o.stopPropagation(),i&&i(t.id)},children:c&&e.jsx("svg",{className:"w-2.5 h-2.5 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"flex-1 min-w-0 cursor-pointer",onClick:o=>{o.stopPropagation(),i&&i(t.id)},onDoubleClick:o=>{o.stopPropagation(),window.open(t.url,"_self")},children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("h4",{className:"font-medium text-foreground text-base truncate",children:t.title})}),t.note&&e.jsx("p",{className:"text-sm text-muted-foreground mb-2 truncate max-w-md",children:t.note}),N.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:N.map(o=>e.jsx(O,{variant:"secondary",className:"text-xs",children:o.name},o.id))})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(P,{variant:"ghost",size:"sm",onClick:h,className:L("h-7 w-7 p-0 transition-opacity",t.isFavorite?"text-yellow-500 hover:text-yellow-600 opacity-100":"text-gray-400 hover:text-yellow-500 opacity-0 group-hover:opacity-100"),title:t.isFavorite?"Remove from favorites":"Add to favorites",children:e.jsx(Q,{className:L("h-4 w-4",t.isFavorite&&"fill-current")})}),e.jsx(P,{variant:"ghost",size:"sm",onClick:p,className:"h-7 w-7 p-0 text-gray-400 hover:text-blue-500 hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity",title:"Edit chat",children:e.jsx(U,{className:"h-4 w-4"})}),e.jsx(P,{variant:"ghost",size:"sm",onClick:v,className:"h-7 w-7 p-0 text-gray-400 hover:text-green-500 hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity",title:"Open chat",children:e.jsx(Se,{className:"h-4 w-4"})})]})]})})})}function Ie({chats:t=[],collections:r=[],viewTitle:a,onBulkAction:n,onBack:u,onEdit:c,onToggleFavorite:i,onOpenChat:p}){const[h,v]=x.useState([]),[N,o]=x.useState("modified");x.useEffect(()=>{v([])},[t]);const l=x.useMemo(()=>[...t].sort((d,g)=>{if(d.isFavorite&&!g.isFavorite)return-1;if(!d.isFavorite&&g.isFavorite)return 1;if(N==="name")return d.title.localeCompare(g.title);if(N==="modified"){const f=d.modifiedAt||d.updatedAt||d.createdAt||d.timestamp||d.id,w=g.modifiedAt||g.updatedAt||g.createdAt||g.timestamp||g.id;if(typeof f=="string"&&typeof w=="string")return w.localeCompare(f);const E=new Date(f),F=new Date(w);return!isNaN(E.getTime())&&!isNaN(F.getTime())?F-E:String(w).localeCompare(String(f))}return 0}),[t,N]),m=s=>{v(d=>d.includes(s)?d.filter(g=>g!==s):[...d,s])},j=()=>{v(y?[]:l.map(s=>s.id))},y=l.length>0&&h.length===l.length,b=a==="Trash";return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 p-3 md:p-4 border-b border-solid border-border",children:[e.jsxs(T,{variant:"default",size:"default",onClick:u,className:"flex items-center gap-2 text-xs sm:text-sm px-3 py-2",children:[e.jsx(me,{size:14,className:"sm:w-4 sm:h-4"})," Back to Tags"]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 flex-wrap w-full sm:w-auto",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-foreground",children:a}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{size:16,className:"text-muted-foreground hidden sm:inline"}),e.jsxs(ie,{value:N,onValueChange:o,children:[e.jsx(oe,{className:"w-[120px] sm:w-36 h-8 text-xs sm:text-sm bg-secondary/50 border-border rounded-full",children:e.jsx(ce,{placeholder:"Sort by..."})}),e.jsxs(de,{children:[e.jsx(G,{value:"modified",children:"By Modified"}),e.jsx(G,{value:"name",children:"By Name"})]})]})]})]})]}),l.length>0&&e.jsxs("div",{className:"mx-2 sm:mx-4 mt-3 sm:mt-4 p-3 sm:p-4 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-4 h-4 rounded border-2 flex items-center justify-center transition-colors cursor-pointer select-none ${y?"bg-blue-500 border-blue-500":"border-gray-400 bg-transparent"}`,onClick:j,children:y&&e.jsx("svg",{className:"w-2.5 h-2.5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("label",{className:"text-sm sm:text-base font-medium text-foreground cursor-pointer select-none",onClick:j,children:"Select All"})]}),h.length>0&&e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-wrap",children:[e.jsxs("span",{className:"text-sm text-muted-foreground font-medium",children:[h.length," selected"]}),b?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>{n("restore",h)},children:[e.jsx(ze,{size:16,className:"mr-1"}),"Restore"]}),e.jsxs(T,{variant:"destructive",size:"sm",onClick:()=>{n("delete_permanently",h)},children:[e.jsx(R,{size:16,className:"mr-1"}),"Delete Permanently"]})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>{n("favorite",h)},className:"bg-secondary/50",children:[e.jsx(Q,{size:16,className:"mr-1"}),"Favorite"]}),e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>{n("trash",h)},className:"bg-secondary/50",children:[e.jsx(R,{size:16,className:"mr-1"}),"Move to Trash"]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4 custom-scrollbar",children:e.jsxs("div",{className:"space-y-2",children:[l.map(s=>e.jsx(He,{chat:s,collections:r,isSelected:h.includes(s.id),onToggleSelection:m,onEdit:c,onToggleFavorite:i,onOpenChat:p},s.id)),l.length===0&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground text-sm",children:"No items found in this view."})})]})})]})}function I({type:t="text",value:r,onChange:a,placeholder:n,icon:u,className:c,...i}){return u?e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",children:u}),e.jsx(B,{type:t,value:r,onChange:a,placeholder:n,className:L("pl-10",c),...i})]}):e.jsx(B,{type:t,value:r,onChange:a,placeholder:n,className:c,...i})}function Ge({onBack:t,settings:r,onSaveSettings:a,searchQuery:n=""}){const[u,c]=x.useState([]),[i,p]=x.useState(null),[h,v]=x.useState(!1),N=u.filter(s=>{if(!n)return!0;const d=n.toLowerCase();return s.name.toLowerCase().includes(d)||s.urlPattern.toLowerCase().includes(d)||s.titlePrefix&&s.titlePrefix.toLowerCase().includes(d)||s.notePrefix&&s.notePrefix.toLowerCase().includes(d)});x.useEffect(()=>{r!=null&&r.aiPlatforms?c(r.aiPlatforms):c([{id:"gemini",name:"Gemini",urlPattern:"https://gemini.google.com/",titlePrefix:"Gemini-",notePrefix:"Gemini chat for",isDefault:!0},{id:"chatgpt",name:"ChatGPT",urlPattern:"https://chatgpt.com/",titlePrefix:"ChatGPT-",notePrefix:"ChatGPT chat for",isDefault:!0},{id:"claude",name:"Claude",urlPattern:"https://claude.ai/",titlePrefix:"Claude-",notePrefix:"Claude chat for",isDefault:!0},{id:"perplexity",name:"Perplexity",urlPattern:"https://www.perplexity.ai/",titlePrefix:"Perplexity-",notePrefix:"Perplexity chat for",isDefault:!0}])},[r]);const o=()=>{p({id:`custom_${Date.now()}`,name:"",urlPattern:"",titlePrefix:"",notePrefix:"",isDefault:!1}),v(!0)},l=s=>{p({...s}),v(!1)},m=()=>{if(!i.name.trim()||!i.urlPattern.trim()){alert("Platform name and URL pattern are required.");return}let s;h?s=[...u,i]:s=u.map(g=>g.id===i.id?i:g),c(s);const d={...r,aiPlatforms:s};a(d),p(null),v(!1)},j=s=>{const d=u.find(g=>g.id===s);if(d!=null&&d.isDefault){alert("Cannot delete default platforms.");return}if(confirm("Are you sure you want to delete this platform?")){const g=u.filter(w=>w.id!==s);c(g);const f={...r,aiPlatforms:g};a(f)}},y=()=>{p(null),v(!1)},b=async()=>{if(confirm("Are you sure you want to sign out? This will close the manager."))try{await we(),window.close()}catch(s){console.error("Sign-out failed:",s),alert("Failed to sign out. Please try again.")}};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 p-3 md:p-4 border-b border-solid border-border",children:[e.jsxs(T,{variant:"ghost",onClick:t,className:"flex items-center gap-2 px-3 py-2 text-xs sm:text-sm bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(me,{size:14,className:"sm:w-4 sm:h-4"})," Back to Collections"]}),e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-foreground",children:"Settings"})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-3 md:p-4 space-y-4 md:space-y-6 custom-scrollbar",children:[e.jsxs("div",{className:"bg-zinc-800/50 backdrop-blur-sm rounded-lg",children:[e.jsx("div",{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm sm:text-base font-medium text-foreground",children:"AI Chat Platforms"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"Configure URL patterns and default titles/notes for AI chat platforms."})]}),e.jsxs(T,{onClick:o,className:"flex items-center gap-2 px-3 py-2 text-xs sm:text-sm bg-green-600 hover:bg-green-700 text-white w-full sm:w-auto",children:[e.jsx(K,{size:14,className:"sm:w-4 sm:h-4"})," Add Platform"]})]})}),e.jsx("div",{className:"p-4 space-y-3",children:N.length>0?N.map(s=>e.jsx("div",{className:"bg-card/30 rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground",style:{fontSize:"15px"},children:s.name}),s.isDefault&&e.jsx(O,{variant:"secondary",className:"text-xs",children:"Default"})]}),e.jsx("p",{className:"text-sm text-muted-foreground font-mono mb-2",children:s.urlPattern}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[s.titlePrefix&&e.jsxs(O,{variant:"outline",className:"text-xs",children:['Title: "',s.titlePrefix,'"']}),s.notePrefix&&e.jsxs(O,{variant:"outline",className:"text-xs",children:['Note: "',s.notePrefix,'"']})]})]}),e.jsxs("div",{className:"flex gap-1 ml-4",children:[e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>l(s),className:"p-2 hover:bg-gray-700",children:e.jsx(U,{size:16})}),!s.isDefault&&e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>j(s.id),className:"p-2 text-red-500 hover:text-red-600 hover:bg-red-500/10",children:e.jsx(R,{size:16})})]})]})},s.id)):n?e.jsx("div",{className:"text-center py-8",children:e.jsxs("p",{className:"text-muted-foreground text-sm",children:['No settings found for "',n,'"']})}):null})]}),e.jsxs("div",{className:"bg-zinc-800/50 backdrop-blur-sm rounded-lg",children:[e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-base font-medium text-foreground",children:"Account"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage your Google Drive account and data synchronization."})]}),e.jsx("div",{className:"p-4",children:e.jsxs(T,{variant:"destructive",onClick:b,className:"flex items-center gap-2 px-3 py-2 bg-red-600 hover:bg-red-700 text-white",children:[e.jsx(Fe,{size:16})," Sign Out"]})})]})]}),e.jsx($,{open:!!i,onOpenChange:s=>!s&&y(),children:e.jsxs(V,{className:"sm:max-w-[425px] bg-zinc-800/95 border-gray-700",children:[e.jsx(_,{children:e.jsx(q,{className:"text-foreground",children:h?"Add New Platform":"Edit Platform"})}),i&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Platform Name *"}),e.jsx(I,{value:i.name,onChange:s=>p({...i,name:s.target.value}),placeholder:"e.g., Custom AI",className:"bg-black/30 border-gray-700 focus:bg-black/20 focus:border-gray-600 text-white placeholder:text-gray-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"URL Pattern *"}),e.jsx(I,{value:i.urlPattern,onChange:s=>p({...i,urlPattern:s.target.value}),placeholder:"e.g., https://example.com/",className:"bg-black/30 border-gray-700 focus:bg-black/20 focus:border-gray-600 text-white placeholder:text-gray-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Default Title Prefix (optional)"}),e.jsx(I,{value:i.titlePrefix,onChange:s=>p({...i,titlePrefix:s.target.value}),placeholder:"e.g., CustomAI-",className:"bg-black/30 border-gray-700 focus:bg-black/20 focus:border-gray-600 text-white placeholder:text-gray-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Default Note Prefix (optional)"}),e.jsx(I,{value:i.notePrefix,onChange:s=>p({...i,notePrefix:s.target.value}),placeholder:"e.g., CustomAI chat for",className:"bg-black/30 border-gray-700 focus:bg-black/20 focus:border-gray-600 text-white placeholder:text-gray-500"})]})]}),e.jsxs(H,{children:[e.jsx(T,{variant:"outline",onClick:y,className:"px-3 py-2 bg-black/30 border-gray-700 text-white hover:bg-black/20",children:"Cancel"}),e.jsx(T,{onClick:m,className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white",children:h?"Add Platform":"Save Changes"})]})]})})]})}function Ke({isOpen:t,onClose:r,onSave:a}){const[n,u]=x.useState(""),[c,i]=x.useState(!1),p=async()=>{if(n.trim()){i(!0);try{await a(n.trim()),u(""),r()}catch(v){alert(v.message)}finally{i(!1)}}},h=v=>{v.key==="Enter"&&!v.shiftKey&&(v.preventDefault(),p())};return e.jsx($,{open:t,onOpenChange:v=>!v&&r(),children:e.jsxs(V,{className:"sm:max-w-[425px] bg-zinc-800/95 border-gray-700",children:[e.jsx(_,{children:e.jsxs(q,{className:"flex items-center gap-2 text-foreground",children:[e.jsx(K,{className:"h-5 w-5"}),"Create New Tag"]})}),e.jsx("div",{className:"py-4 space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Tag Name"}),e.jsx(B,{value:n,onChange:v=>u(v.target.value),onKeyPress:h,placeholder:"Enter tag name...",autoFocus:!0,className:"bg-black/30 border-gray-700 focus:bg-black/20 focus:border-gray-600 text-white placeholder:text-gray-500"})]})}),e.jsxs(H,{className:"flex gap-2",children:[e.jsx(P,{variant:"outline",onClick:r,disabled:c,className:"bg-black/30 hover:bg-black/20 text-white border-gray-700",children:"Cancel"}),e.jsx(P,{onClick:p,disabled:!n.trim()||c,className:"bg-blue-600 hover:bg-blue-700 text-white",children:c?"Creating...":"Create Tag"})]})]})})}function Ue({isOpen:t,onClose:r,onSave:a,collection:n}){const[u,c]=x.useState("");x.useEffect(()=>{n&&c(n.name||"")},[n]);const i=async()=>{if(!(!u.trim()||u.trim()===(n==null?void 0:n.name)))try{const h={...n,name:u.trim(),dateModified:new Date().toISOString()};await a(h)}catch(h){alert(h.message||"Failed to rename tag. Please try again.")}},p=h=>{h.key==="Enter"&&(h.preventDefault(),i())};return e.jsx($,{open:t,onOpenChange:h=>!h&&r(),children:e.jsxs(V,{className:"sm:max-w-[425px] bg-zinc-800/95 border-gray-700",children:[e.jsx(_,{children:e.jsxs(q,{className:"flex items-center gap-2 text-foreground",children:[e.jsx(U,{className:"h-5 w-5"}),"Rename Tag"]})}),e.jsx("div",{className:"py-4 space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Tag Name"}),e.jsx(B,{value:u,onChange:h=>c(h.target.value),onKeyPress:p,placeholder:"e.g., Project X",autoFocus:!0,className:"bg-black/30 border-gray-700 focus:bg-black/20 focus:border-gray-600 text-white placeholder:text-gray-500"})]})}),e.jsxs(H,{className:"flex gap-2",children:[e.jsx(P,{variant:"outline",onClick:r,className:"bg-black/30 hover:bg-black/20 text-white border-gray-700",children:"Cancel"}),e.jsx(P,{onClick:i,disabled:!u.trim()||u.trim()===(n==null?void 0:n.name),className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Rename Tag"})]})]})})}function Qe({collections:t,selectedIds:r,onToggleCollection:a}){return e.jsxs("div",{className:"space-y-1 max-h-32 overflow-y-auto custom-scrollbar border border-gray-700 rounded-md p-2",children:[t.map(n=>{const u=r.includes(n.id);return e.jsx("div",{onClick:()=>a(n.id),className:L("flex items-center justify-between p-2 rounded cursor-pointer transition-all duration-200",u?"bg-primary/20 border border-primary text-primary-foreground":"bg-card border-border hover:bg-accent hover:border-accent-foreground"),children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:L("w-4 h-4 rounded border-2 flex items-center justify-center transition-colors",u?"bg-blue-600 border-blue-600":"border-gray-500 hover:border-gray-400"),children:u&&e.jsx("svg",{className:"w-2.5 h-2.5 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:n.name}),e.jsxs("div",{className:"flex items-center space-x-1",children:[n.isPinned&&e.jsx(ne,{size:12,filled:!0,className:"text-blue-400"}),n.isFavorite&&e.jsx("div",{className:"w-1.5 h-1.5 bg-yellow-500 rounded-full",title:"Favorite"})]})]})]}),e.jsx(O,{variant:"secondary",className:"text-xs",children:n.chatCount||0})]})},n.id)}),t.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-2",children:"No tags available"})]})}function We({isOpen:t,onClose:r,onSave:a,chat:n,allCollections:u=[],onCreateCollection:c}){const[i,p]=x.useState(""),[h,v]=x.useState(""),[N,o]=x.useState([]),[l,m]=x.useState(!1),[j,y]=x.useState("");x.useEffect(()=>{n?(p(n.title||""),v(n.note||""),o(n.collectionIds||[])):(p(""),v(""),o([]))},[n]);const b=()=>{if(!i.trim()){alert("Please enter a title for the chat.");return}const f={...n,title:i.trim(),note:h.trim(),collectionIds:N};a(f),r()},s=async()=>{if(j.trim())try{const f=await c(j.trim());o(w=>[...w,f.id]),y(""),m(!1)}catch(f){alert(f.message)}},d=f=>{o(w=>w.includes(f)?w.filter(E=>E!==f):[...w,f])},g=[...u].sort((f,w)=>f.isPinned&&!w.isPinned?-1:!f.isPinned&&w.isPinned?1:f.isFavorite&&!w.isFavorite?-1:!f.isFavorite&&w.isFavorite?1:f.name.localeCompare(w.name));return e.jsx($,{open:t,onOpenChange:f=>!f&&r(),children:e.jsxs(V,{className:"sm:max-w-[420px] bg-zinc-800/95 border-gray-700",children:[e.jsx(_,{children:e.jsx(q,{className:"text-foreground",children:"Edit Chat"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Title"}),e.jsx(B,{value:i,onChange:f=>p(f.target.value),placeholder:"Enter chat title...",className:"bg-black/30 border-gray-700 focus:bg-black/20 focus:border-gray-600 text-white placeholder:text-gray-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Note"}),e.jsx("textarea",{value:h,onChange:f=>v(f.target.value),placeholder:"Add a note (optional)...",rows:3,className:"w-full px-3 py-2 bg-black/30 border border-gray-700 rounded-xl text-white placeholder:text-gray-500 text-sm focus:outline-none focus:bg-black/20 focus:border-gray-600 resize-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Tags"}),e.jsxs(P,{variant:"ghost",size:"sm",onClick:()=>m(!l),className:"text-xs text-green-500 hover:text-green-400",children:[e.jsx(K,{className:"h-3 w-3 mr-1"}),"Add New"]})]}),l&&e.jsxs("div",{className:"flex gap-2 p-3 bg-zinc-900/50 rounded-lg border border-gray-700",children:[e.jsx(B,{value:j,onChange:f=>y(f.target.value),placeholder:"Tag name...",className:"flex-1 bg-black/30 border-gray-700 focus:bg-black/20 focus:border-gray-600 text-white placeholder:text-gray-500 text-sm",onKeyPress:f=>{f.key==="Enter"&&s()}}),e.jsx(P,{onClick:s,size:"sm",className:"px-3 py-1 h-8 bg-green-600 hover:bg-green-700 text-white text-xs",children:"Add"})]}),e.jsx(Qe,{collections:g,selectedIds:N,onToggleCollection:d})]})]}),e.jsxs(H,{className:"flex gap-2",children:[e.jsx(P,{variant:"outline",onClick:r,className:"bg-black/30 hover:bg-black/20 text-white border-gray-700",children:"Cancel"}),e.jsx(P,{onClick:b,className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Save Changes"})]})]})})}function re({isOpen:t,onClose:r,onConfirm:a,title:n,children:u}){const c=r===a;return e.jsx($,{open:t,onOpenChange:i=>!i&&r(),children:e.jsxs(V,{className:"sm:max-w-[425px] bg-zinc-800/95 border-gray-700",children:[e.jsx(_,{children:e.jsx(q,{className:"text-foreground",children:n})}),e.jsx("div",{className:"py-4",children:e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:u})}),e.jsxs(H,{className:`flex gap-2 ${c?"justify-center":"justify-end"}`,children:[!c&&e.jsx(P,{variant:"outline",onClick:r,className:"bg-black/30 hover:bg-black/20 text-white border-gray-700",children:"Cancel"}),e.jsx(P,{variant:c?"default":"destructive",onClick:a,className:c?"bg-blue-600 hover:bg-blue-700 text-white":"",children:c?"OK":"Confirm"})]})]})})}function Xe({modals:t,alertModal:r,appData:a,onCloseModal:n,onCreateCollection:u,onEditCollection:c,onSaveChatChanges:i,onCloseAlert:p,onConfirmDelete:h}){var v,N,o,l,m,j,y,b,s,d,g,f;return e.jsxs(e.Fragment,{children:[e.jsx(Ke,{isOpen:t.createCollection,onClose:()=>n("createCollection"),onSave:u}),e.jsx(Ue,{isOpen:!!t.editCollection,onClose:()=>n("editCollection"),onSave:c,collection:t.editCollection}),e.jsx(We,{isOpen:!!t.editChat,onClose:()=>n("editChat"),onSave:i,chat:t.editChat,allCollections:a.collections.filter(w=>!w.isDeleted),onCreateCollection:u}),e.jsx(re,{isOpen:!!t.confirm,onClose:()=>n("confirm"),onConfirm:h,title:((v=t.confirm)==null?void 0:v.type)==="collection_trash"?"Delete Tag":(o=(N=t.confirm)==null?void 0:N.type)!=null&&o.includes("permanent")?"Permanently Delete":(m=(l=t.confirm)==null?void 0:l.type)!=null&&m.includes("trash")?"Move to Trash":"Confirm Action",children:t.confirm&&e.jsxs(e.Fragment,{children:[t.confirm.type==="collection_trash"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm",children:"Are you sure you want to delete this tag?"}),e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-blue-300 mb-2 font-medium",children:"ℹ️ What happens when you delete:"}),e.jsxs("ul",{className:"text-xs text-muted-foreground space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"The tag will be deleted"}),e.jsx("li",{children:"Chats with this tag will NOT be deleted"}),e.jsx("li",{children:'Chats will remain in "All Chats" but lose this tag'})]})]})]}),((y=(j=t.confirm)==null?void 0:j.type)==null?void 0:y.includes("permanent"))&&((b=t.confirm)==null?void 0:b.type)!=="collection_trash"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mb-2",children:["Are you sure you want to permanently delete"," ",e.jsx("strong",{children:t.confirm.count||1})," item(s)?"]}),e.jsx("p",{className:"text-red-400 text-xs",children:"This action cannot be undone!"})]}),((s=t.confirm.type)==null?void 0:s.includes("trash"))&&!((d=t.confirm.type)!=null&&d.includes("permanent"))&&t.confirm.type!=="collection_trash"&&e.jsxs("p",{children:["Are you sure you want to move"," ",e.jsx("strong",{children:t.confirm.count||1})," item(s) to trash?"]}),!((g=t.confirm.type)!=null&&g.includes("permanent"))&&!((f=t.confirm.type)!=null&&f.includes("trash"))&&e.jsxs("p",{children:["Are you sure you want to perform this action on"," ",e.jsx("strong",{children:t.confirm.count||1})," item(s)?"]})]})}),e.jsx(re,{isOpen:!!r,onClose:p,onConfirm:p,title:(r==null?void 0:r.title)||"Alert",children:r==null?void 0:r.message})]})}function Ye(){const[t,r]=x.useState(!1),{appData:a,isLoading:n,updateAppData:u}=De(),{currentView:c,setCurrentView:i,filteredChats:p,setFilteredChats:h,viewTitle:v,setViewTitle:N,searchQuery:o,setSearchQuery:l,isSearchFocused:m,setIsSearchFocused:j,modals:y,alertModal:b,setAlertModal:s,isProcessing:d,setIsProcessing:g,openModal:f,closeModal:w,showAlert:E}=Ae(),F=Oe(a,u,E,f,w),S=Be(a,u,E,f,w,h,g),M=x.useMemo(()=>{let C=a.collections.filter(k=>!k.isDeleted);return o&&c==="collections"&&(C=C.filter(k=>k.name.toLowerCase().includes(o.toLowerCase()))),ue(C)},[a.collections,o,c]),D=x.useMemo(()=>{let C=p;return o&&c==="allChats"&&(C=p.filter(k=>{var ee;const X=k.title.toLowerCase().includes(o),ye=(ee=k.note)==null?void 0:ee.toLowerCase().includes(o),be=k.collectionIds.some(pe=>{var te;return(te=a.collections.find(ve=>ve.id===pe))==null?void 0:te.name.toLowerCase().includes(o)});return X||ye||be})),A(C)},[a.chats,a.collections,o,p]),W=x.useCallback(C=>{i(C),C==="collections"?(N("Tags"),h([])):C==="allChats"?(N("All Chats"),h(a.chats.filter(k=>!k.isDeleted))):C==="settings"&&(N("Settings"),h([]))},[a.chats,i,N,h]),Y=x.useCallback(C=>{const k=F.handleSelectCollection(C);k.view==="settings"?(i("settings"),N("Settings")):(N(k.title),h(A(k.chats)),i("allChats"))},[F,i,N,h]),J=x.useCallback(()=>{i("collections"),N("Tags"),h([])},[i,N,h]),he=x.useCallback((C,k)=>{C==="trash"||C==="delete_permanently"?f("confirm",{type:`bulk_${C}`,ids:k,count:k.length}):S.handleBulkAction(C,k)},[f,S]),fe=x.useCallback(async()=>{const C=y.confirm;if(C){w("confirm"),g(!0);try{switch(C.type){case"collection_trash":await F.handleDeleteCollection(C.id);break;case"chat_trash":await S.handleDeleteChat(C.id);break;case"chat_permanent":await S.handleDeleteChatPermanently(C.id);break;case"bulk_trash":await S.handleBulkAction("trash",C.ids);break;case"bulk_delete_permanently":await S.handleBulkAction("delete_permanently",C.ids);break;case"bulk_restore":await S.handleBulkAction("restore",C.ids);break;default:console.warn("Unknown delete type:",C.type)}}catch(k){console.error("Delete operation failed:",k),E("Error","Failed to complete the operation. Please try again.")}finally{g(!1)}}},[y.confirm,F,S,w,E,g]),Z=x.useMemo(()=>Re(C=>{l(C.toLowerCase().trim())},300),[l]),ge=x.useCallback(C=>{Z(C)},[Z]);return n?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx(se,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("div",{className:"text-foreground",children:"Loading your data..."})]})}):e.jsxs("div",{className:"flex h-screen bg-background",children:[e.jsx(Ve,{currentView:c,onViewChange:W,onSelectCollection:Y,viewTitle:v,isMobileOpen:t,onMobileClose:()=>r(!1)}),e.jsx("main",{className:"flex-1 flex flex-col justify-start overflow-hidden bg-background px-4 md:px-8 py-4 md:py-6 h-full w-full",children:e.jsxs("div",{className:"max-w-5xl mx-auto w-full flex flex-col h-full",children:[e.jsx($e,{onSearch:ge,isSearchFocused:m,onFocusChange:j,onMobileMenuClick:()=>r(!0)}),e.jsx("div",{className:"flex-1 bg-card/50 rounded-xl p-3 md:p-6 shadow-sm overflow-hidden",children:c==="collections"?e.jsx(qe,{collections:M,chats:a.chats,onSelectCollection:Y,onCreateCollection:()=>f("createCollection"),onEditCollection:C=>{const k=a.collections.find(X=>X.id===C);f("editCollection",k)},onDeleteCollection:C=>f("confirm",{type:"collection_trash",id:C}),onToggleFavoriteCollection:F.handleToggleFavoriteCollection,onTogglePinCollection:F.handleTogglePinCollection,searchQuery:o}):c==="settings"?e.jsx(Ge,{onBack:J,settings:a.settings||{},onSaveSettings:C=>{u({...a,settings:{...a.settings,...C}})},searchQuery:o}):e.jsx(Ie,{chats:D,collections:a.collections.filter(C=>!C.isDeleted),viewTitle:o?`Search results for "${o}"`:v,onBack:J,onBulkAction:he,onEdit:S.handleEditChat,onToggleFavorite:S.handleToggleFavorite,onOpenChat:S.handleOpenChat})})]})}),e.jsx(Xe,{modals:y,alertModal:b,appData:a,onCloseModal:w,onCreateCollection:F.handleCreateCollection,onEditCollection:F.handleEditCollection,onSaveChatChanges:S.handleSaveChatChanges,onCloseAlert:()=>s(null),onConfirmDelete:fe}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[100]",children:e.jsxs("div",{className:"bg-card/95 rounded-xl shadow-2xl border border-border/50 flex flex-col items-center gap-4 w-full max-w-[425px] p-6",children:[e.jsx(se,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("div",{className:"text-foreground font-medium text-center",children:"Processing..."}),e.jsx("div",{className:"text-sm text-muted-foreground text-center",children:"Please wait while we update your data"})]})})]})}document.documentElement.classList.add("dark");ke.createRoot(document.getElementById("root")).render(e.jsx(Pe.StrictMode,{children:e.jsx(Ye,{})}));
