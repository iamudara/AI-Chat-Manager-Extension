import{c as E,r as m,i as je,h as Ce,j as e,X as Ne,C as ae,l as L,d as le,B as F,b as ne,e as O,S as ie,m as oe,n as ce,o as de,p as G,a as z,P as K,I as B,D as $,q as V,t as _,u as q,v as H,w as we,L as se,k as ke,R as Pe}from"./global-BjklyNvB.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=E("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=E("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=E("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=E("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=E("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=E("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=E("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=E("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=E("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=E("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=E("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=E("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);function Ae(){const[t,r]=m.useState({chats:[],collections:[],settings:{}}),[a,n]=m.useState(!0),[h,d]=m.useState(null);m.useEffect(()=>{(async()=>{try{const f=await Ce();r(f)}catch(f){console.error("Failed to load data:",f),d(f.message)}finally{n(!1)}})()},[]);const i=m.useCallback(async b=>{const f=t;r(b);try{await je(b)}catch(p){throw console.error("Failed to save data:",p),r(f),new Error("Could not save your changes.")}},[t]);return{appData:t,isLoading:a,error:h,updateAppData:i,setAppData:r}}function De(){const[t,r]=m.useState("collections"),[a,n]=m.useState([]),[h,d]=m.useState("Collections"),[i,b]=m.useState(""),[f,p]=m.useState(!1),[N,o]=m.useState({createCollection:!1,editCollection:null,editChat:null,confirm:null}),[l,x]=m.useState(null),[v,g]=m.useState(!1),[y,s]=m.useState(null),[c,u]=m.useState(null),[C,P]=m.useState(null),w=m.useCallback((A,D=null)=>{o(W=>({...W,[A]:D||!0}))},[]),k=m.useCallback(A=>{o(D=>({...D,[A]:null}))},[]),T=m.useCallback((A,D)=>{x({title:A,message:D})},[]);return{currentView:t,setCurrentView:r,filteredChats:a,setFilteredChats:n,viewTitle:h,setViewTitle:d,searchQuery:i,setSearchQuery:b,isSearchFocused:f,setIsSearchFocused:p,modals:N,setModals:o,alertModal:l,setAlertModal:x,isProcessing:v,setIsProcessing:g,itemToDelete:y,setItemToDelete:s,chatToEdit:c,setChatToEdit:u,collectionToEdit:C,setCollectionToEdit:P,openModal:w,closeModal:k,showAlert:T}}function ue(t){return[...t].sort((r,a)=>r.isPinned!==a.isPinned?a.isPinned-r.isPinned:r.isFavorite!==a.isFavorite?a.isFavorite-r.isFavorite:r.name.localeCompare(a.name))}function M(t){return[...t].sort((r,a)=>{if(r.isFavorite!==a.isFavorite)return a.isFavorite-r.isFavorite;const n=new Date(r.dateModified||r.createdAt||0);return new Date(a.dateModified||a.createdAt||0)-n})}function Oe(t,r,a,n,h){const d=m.useCallback(o=>{let l=[],x="";const v={favorites:()=>{x="Favorites",l=t.chats.filter(s=>s.isFavorite&&!s.isDeleted)},trash:()=>{x="Trash",l=t.chats.filter(s=>s.isDeleted)},settings:()=>({view:"settings",title:"Settings"}),default:()=>{const s=t.collections.find(c=>c.id===o);s&&(x=`Tag: ${s.name}`,l=t.chats.filter(c=>c.collectionIds.includes(o)&&!c.isDeleted))}};return(v[o]||v.default)()||{chats:l,title:x,view:"allChats"}},[t.chats,t.collections]),i=m.useCallback(async o=>{try{if(t.collections.some(v=>!v.isDeleted&&v.name.toLowerCase()===o.toLowerCase()))throw new Error(`A tag named "${o}" already exists.`);const l={id:`col_${Date.now()}`,name:o,isPinned:!1,isFavorite:!1,isDeleted:!1,dateCreated:new Date().toISOString(),dateDeleted:null},x={...t,collections:ue([...t.collections,l])};return await r(x),h("createCollection"),l}catch(l){throw console.error("Failed to create collection:",l),l}},[t,r,h]),b=m.useCallback(async o=>{try{const l={...t,collections:t.collections.map(x=>x.id===o?{...x,isFavorite:!x.isFavorite}:x)};await r(l)}catch(l){console.error("Failed to toggle favorite collection:",l),a("Error","Failed to update tag. Please try again.")}},[t,r,a]),f=m.useCallback(async o=>{try{const l=t.collections.filter(g=>g.isPinned&&!g.isDeleted).length;if(!t.collections.find(g=>g.id===o).isPinned&&l>=3){a("Pin Limit Reached","You can only pin up to 3 tags for Quick Access. Please unpin another tag first.");return}const v={...t,collections:t.collections.map(g=>g.id===o?{...g,isPinned:!g.isPinned}:g)};await r(v)}catch(l){console.error("Failed to toggle pin collection:",l),a("Error","Failed to update tag. Please try again.")}},[t,r,a]),p=m.useCallback(async o=>{try{if(t.collections.find(v=>!v.isDeleted&&v.id!==o.id&&v.name.toLowerCase()===o.name.toLowerCase()))throw new Error(`A tag named "${o.name}" already exists.`);const x={...t,collections:t.collections.map(v=>v.id===o.id?{...v,...o,dateModified:new Date().toISOString()}:v)};await r(x),h("editCollection")}catch(l){throw console.error("Failed to edit collection:",l),l}},[t,r,h]),N=m.useCallback(async o=>{try{const l={...t,collections:t.collections.map(x=>x.id===o?{...x,isDeleted:!0,dateDeleted:new Date().toISOString()}:x)};await r(l),h("confirm"),a("Success","Tag deleted.")}catch(l){console.error("Failed to delete tag:",l),a("Error","Failed to delete tag. Please try again.")}},[t,r,h,a]);return{handleSelectCollection:d,handleCreateCollection:i,handleEditCollection:p,handleToggleFavoriteCollection:b,handleTogglePinCollection:f,handleDeleteCollection:N}}function Be(t,r,a,n,h,d,i){const b=m.useCallback(g=>{const y=t.chats.find(s=>s.id===g);y&&n("editChat",y)},[t.chats,n]),f=m.useCallback(async g=>{try{const y={...g,dateModified:new Date().toISOString()};d(c=>{const u=c.map(C=>C.id===g.id?y:C);return M(u)}),h("editChat");const s=t.chats.map(c=>c.id===g.id?y:c);await r({...t,chats:s})}catch(y){console.error("Failed to save chat changes:",y),d(s=>{const c=s.map(u=>u.id===g.id&&t.chats.find(C=>C.id===g.id)||u);return M(c)}),a("Error","Failed to save changes. Please try again.")}},[t,r,h,d,a]),p=m.useCallback(async g=>{try{let y;const s=t.chats.map(c=>c.id===g?(y={...c,isFavorite:!c.isFavorite},y):c);d(c=>{const u=c.map(C=>C.id===g?y:C);return M(u)}),await r({...t,chats:s})}catch(y){console.error("Failed to toggle favorite:",y),a("Error","Failed to update chat. Please try again.")}},[t,r,d,a]),N=m.useCallback(g=>{g&&window.open(g,"_blank")},[]),o=m.useCallback(async g=>{try{const y=t.chats.map(s=>s.id===g?{...s,isDeleted:!0,dateDeleted:new Date().toISOString()}:s);await r({...t,chats:y}),d(s=>{const c=s.map(u=>u.id===g?{...u,isDeleted:!0,dateDeleted:new Date().toISOString()}:u);return M(c)}),a("Success","Chat moved to trash.")}catch(y){console.error("Failed to delete chat:",y),a("Error","Failed to delete chat. Please try again.")}},[t,r,d,a]),l=m.useCallback(async g=>{try{const y=t.chats.map(s=>s.id===g?{...s,isDeleted:!1,dateDeleted:null}:s);await r({...t,chats:y}),d(s=>s.filter(c=>c.id!==g)),a("Success","Chat restored successfully.")}catch(y){console.error("Failed to restore chat:",y),a("Error","Failed to restore chat. Please try again.")}},[t,r,d,a]),x=m.useCallback(async g=>{try{const y=t.chats.filter(s=>s.id!==g);await r({...t,chats:y}),d(s=>s.filter(c=>c.id!==g)),a("Success","Chat permanently deleted.")}catch(y){console.error("Failed to permanently delete chat:",y),a("Error","Failed to permanently delete chat. Please try again.")}},[t,r,d,a]),v=m.useCallback(async(g,y)=>{i&&i(!0);try{let s=[...t.chats],c="";switch(g){case"favorite":s=s.map(u=>y.includes(u.id)?{...u,isFavorite:!0}:u),c=`${y.length} item(s) marked as favorite.`;break;case"trash":s=s.map(u=>y.includes(u.id)?{...u,isDeleted:!0,dateDeleted:new Date().toISOString()}:u),c=`${y.length} item(s) moved to trash.`;break;case"restore":s=s.map(u=>y.includes(u.id)?{...u,isDeleted:!1,dateDeleted:null}:u),c=`${y.length} item(s) restored.`;break;case"delete_permanently":s=s.filter(u=>!y.includes(u.id)),c=`${y.length} item(s) permanently deleted.`;break;default:i&&i(!1);return}await r({...t,chats:M(s)}),g==="trash"||g==="restore"||g==="delete_permanently"?d(u=>u.filter(C=>!y.includes(C.id))):g==="favorite"&&d(u=>M(u.map(C=>y.includes(C.id)?{...C,isFavorite:!0}:C))),i&&i(!1),a("Success",c)}catch(s){console.error("Failed to perform bulk action:",s),i&&i(!1),a("Error","Failed to perform bulk action. Please try again.")}},[t,r,d,a,i]);return{handleEditChat:b,handleSaveChatChanges:f,handleToggleFavorite:p,handleOpenChat:N,handleDeleteChat:o,handleRestoreChat:l,handleDeleteChatPermanently:x,handleBulkAction:v}}function Re(t,r){let a;return function(...h){const d=()=>{clearTimeout(a),t(...h)};clearTimeout(a),a=setTimeout(d,r)}}function $e({onSearch:t,isSearchFocused:r,onFocusChange:a,onMobileMenuClick:n}){return e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-6 mt-6",children:[e.jsx("button",{onClick:n,className:"md:hidden p-2 hover:bg-secondary rounded-lg transition-colors flex-shrink-0",children:e.jsx(Te,{className:"w-5 h-5 text-foreground"})}),e.jsxs("div",{className:`relative transition-all duration-500 ease-in-out ${r?"w-[calc(100%-5rem)] md:w-[700px]":"w-[calc(100%-5rem)] md:w-[600px]"}`,children:[e.jsx(Ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Search Tags, chats, and settings...",onChange:h=>t(h.target.value),onFocus:()=>a(!0),onBlur:()=>a(!1),className:`w-full pl-10 pr-4 py-2 bg-secondary/50 border border-border rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-500 ease-in-out ${r?"py-3":"py-2"}`})]})]})}function Ve({currentView:t,onViewChange:r,onSelectCollection:a,viewTitle:n,isMobileOpen:h,onMobileClose:d}){const i=b=>{b(),d&&d()};return e.jsxs(e.Fragment,{children:[h&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 md:hidden",onClick:d}),e.jsx("nav",{className:`
        fixed md:static
        w-64 h-full
        bg-secondary/50 md:bg-secondary/50
        backdrop-blur-xl md:backdrop-blur-none
        border-r border-border/50 md:border-r-0
        shadow-2xl md:shadow-none
        overflow-y-auto custom-scrollbar
        z-50
        transition-transform duration-300 ease-in-out
        ${h?"translate-x-0":"-translate-x-full md:translate-x-0"}
      `,children:e.jsxs("div",{className:"p-4 space-y-1 mt-16 md:mt-24",children:[e.jsx("button",{onClick:d,className:"md:hidden absolute top-4 right-4 p-2 hover:bg-secondary rounded-lg transition-colors z-10",children:e.jsx(Ne,{className:"w-5 h-5 text-foreground"})}),e.jsx("button",{onClick:()=>i(()=>r("collections")),className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors ${t==="collections"?"bg-primary text-primary-foreground":"hover:bg-secondary text-foreground"}`,children:"Tags"}),e.jsx("button",{onClick:()=>i(()=>r("allChats")),className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors ${t==="allChats"&&n==="All Chats"?"bg-primary text-primary-foreground":"hover:bg-secondary text-foreground"}`,children:"All Chats"}),e.jsxs("div",{className:"pt-4",children:[e.jsx("div",{className:"px-3 py-2 text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Static Folders"}),e.jsxs("button",{onClick:()=>i(()=>a("favorites")),className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors flex items-center ${n==="Favorites"?"bg-primary text-primary-foreground":"hover:bg-secondary text-foreground"}`,children:[e.jsx(Q,{className:"w-4 h-4 mr-3 text-yellow-500"}),"Favorites"]}),e.jsxs("button",{onClick:()=>i(()=>a("trash")),className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors flex items-center ${n==="Trash"?"bg-primary text-primary-foreground":"hover:bg-secondary text-foreground"}`,children:[e.jsx(R,{className:"w-4 h-4 mr-3 text-red-500"}),"Trash"]})]}),e.jsx("div",{className:"pt-4 border-t border-border",children:e.jsxs("button",{onClick:()=>i(()=>r("settings")),className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors flex items-center ${t==="settings"?"bg-primary text-primary-foreground":"hover:bg-secondary text-foreground"}`,children:[e.jsx(Le,{className:"w-4 h-4 mr-3"}),"Settings"]})})]})})]})}function _e({collection:t,chatCount:r,onSelect:a,onEdit:n,onDelete:h,onToggleFavorite:d,onTogglePin:i}){const b=t.name.includes("/"),f=b?t.name.split("/")[1]:t.name,p=x=>{x.stopPropagation(),n(t.id)},N=x=>{x.stopPropagation(),h(t.id)},o=x=>{x.stopPropagation(),d&&d(t.id)},l=x=>{x.stopPropagation(),i&&i(t.id)};return e.jsx(ae,{className:L("group cursor-pointer hover:bg-gray-700/40 hover:border-gray-600 transition-all duration-200 mb-2",b&&"ml-6"),onClick:()=>a(t.id),children:e.jsx(le,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx(Me,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-foreground truncate text-base",children:f})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[i&&e.jsx(F,{variant:"ghost",size:"sm",onClick:l,className:L("h-7 w-7 p-0 transition-opacity",t.isPinned?"text-blue-500 hover:text-blue-600 opacity-100":"text-gray-400 hover:text-blue-500 opacity-0 group-hover:opacity-100"),title:t.isPinned?"Unpin collection":"Pin collection",children:e.jsx(ne,{size:16,filled:t.isPinned})}),d&&e.jsx(F,{variant:"ghost",size:"sm",onClick:o,className:L("h-7 w-7 p-0 transition-opacity",t.isFavorite?"text-yellow-500 hover:text-yellow-600 opacity-100":"text-gray-400 hover:text-yellow-500 opacity-0 group-hover:opacity-100"),title:t.isFavorite?"Remove from favorites":"Add to favorites",children:e.jsx(Q,{className:L("h-4 w-4",t.isFavorite&&"fill-current")})}),e.jsxs(O,{variant:"secondary",className:"text-xs",children:[r," chats"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(F,{variant:"ghost",size:"sm",onClick:p,className:"h-7 w-7 p-0 text-gray-400 hover:text-blue-500 hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity",title:"Edit collection",children:e.jsx(U,{className:"h-4 w-4"})}),e.jsx(F,{variant:"ghost",size:"sm",onClick:N,className:"h-7 w-7 p-0 text-gray-400 hover:text-red-500 hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity",title:"Delete collection",children:e.jsx(R,{className:"h-4 w-4"})})]})]})]})})})}function qe({collections:t=[],chats:r=[],onSelectCollection:a,onCreateCollection:n,onEditCollection:h,onDeleteCollection:d,onToggleFavoriteCollection:i,onTogglePinCollection:b}){const[f,p]=m.useState("name"),N=m.useMemo(()=>{const l={};return Array.isArray(r)&&r.forEach(x=>{x&&!x.isDeleted&&Array.isArray(x.collectionIds)&&x.collectionIds.forEach(v=>{v&&(l[v]=(l[v]||0)+1)})}),l},[r]),o=m.useMemo(()=>Array.isArray(t)?[...t].sort((l,x)=>{if(l.isPinned!==x.isPinned)return x.isPinned-l.isPinned;if(l.isPinned&&x.isPinned&&l.isFavorite!==x.isFavorite||!l.isPinned&&!x.isPinned&&l.isFavorite!==x.isFavorite)return x.isFavorite-l.isFavorite;if(f==="name")return l.name.localeCompare(x.name);if(f==="modified"){const v=c=>{const u=[c.modifiedAt,c.updatedAt,c.createdAt,c.dateCreated,c.timestamp];for(const C of u)if(C){const P=new Date(C);if(!isNaN(P.getTime()))return P}return new Date(0)},g=v(l),s=v(x)-g;if(s===0){const c=String(l.modifiedAt||l.updatedAt||l.createdAt||l.dateCreated||l.id||"");return String(x.modifiedAt||x.updatedAt||x.createdAt||x.dateCreated||x.id||"").localeCompare(c)}return s}return 0}):[],[t,f]);return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 p-3 md:p-4 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 flex-wrap",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-foreground",children:"Tags"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{size:16,className:"text-muted-foreground hidden sm:inline"}),e.jsxs(ie,{value:f,onValueChange:p,children:[e.jsx(oe,{className:"w-[120px] sm:w-[140px] h-8 text-xs sm:text-sm bg-secondary/50 border-border rounded-full",children:e.jsx(ce,{placeholder:"Sort by..."})}),e.jsxs(de,{children:[e.jsx(G,{value:"name",children:"By Name"}),e.jsx(G,{value:"modified",children:"By Modified"})]})]})]})]}),e.jsxs(z,{onClick:n,className:"flex items-center gap-2 text-xs sm:text-sm px-3 sm:px-4 py-2 w-full sm:w-auto",children:[e.jsx(K,{size:14,className:"sm:w-4 sm:h-4"})," Create New Tag"]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4 space-y-2 custom-scrollbar",children:o.map(l=>e.jsx(_e,{collection:l,chatCount:N[l.id]||0,onSelect:a,onEdit:h,onDelete:d,onToggleFavorite:i,onTogglePin:b},l.id))})]})}function He({chat:t,collections:r=[],onEdit:a,onToggleFavorite:n,onOpenChat:h,isSelected:d,onToggleSelection:i}){const b=o=>{o.stopPropagation(),a(t.id)},f=o=>{o.stopPropagation(),n(t.id)},p=o=>{o.stopPropagation(),h(t.url)},N=r.filter(o=>{var l;return(l=t.collectionIds)==null?void 0:l.includes(o.id)});return e.jsx(ae,{className:"group hover:bg-gray-700/40 hover:border-gray-600 transition-all duration-200 mb-2",children:e.jsx(le,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:L("w-4 h-4 rounded border-2 flex items-center justify-center transition-colors cursor-pointer mt-1",d?"bg-blue-600 border-blue-600":"border-gray-400 hover:border-gray-300"),onClick:o=>{o.stopPropagation(),i&&i(t.id)},children:d&&e.jsx("svg",{className:"w-2.5 h-2.5 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"flex-1 min-w-0 cursor-pointer",onClick:o=>{o.stopPropagation(),i&&i(t.id)},onDoubleClick:o=>{o.stopPropagation(),window.open(t.url,"_self")},children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("h4",{className:"font-medium text-foreground text-base truncate",children:t.title})}),t.note&&e.jsx("p",{className:"text-sm text-muted-foreground mb-2 truncate max-w-md",children:t.note}),N.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:N.map(o=>e.jsx(O,{variant:"secondary",className:"text-xs",children:o.name},o.id))})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(F,{variant:"ghost",size:"sm",onClick:f,className:L("h-7 w-7 p-0 transition-opacity",t.isFavorite?"text-yellow-500 hover:text-yellow-600 opacity-100":"text-gray-400 hover:text-yellow-500 opacity-0 group-hover:opacity-100"),title:t.isFavorite?"Remove from favorites":"Add to favorites",children:e.jsx(Q,{className:L("h-4 w-4",t.isFavorite&&"fill-current")})}),e.jsx(F,{variant:"ghost",size:"sm",onClick:b,className:"h-7 w-7 p-0 text-gray-400 hover:text-blue-500 hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity",title:"Edit chat",children:e.jsx(U,{className:"h-4 w-4"})}),e.jsx(F,{variant:"ghost",size:"sm",onClick:p,className:"h-7 w-7 p-0 text-gray-400 hover:text-green-500 hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity",title:"Open chat",children:e.jsx(Se,{className:"h-4 w-4"})})]})]})})})}function Ie({chats:t=[],collections:r=[],viewTitle:a,onBulkAction:n,onBack:h,onEdit:d,onToggleFavorite:i,onOpenChat:b}){const[f,p]=m.useState([]),[N,o]=m.useState("modified");m.useEffect(()=>{p([])},[t]);const l=m.useMemo(()=>[...t].sort((c,u)=>{if(c.isFavorite&&!u.isFavorite)return-1;if(!c.isFavorite&&u.isFavorite)return 1;if(N==="name")return c.title.localeCompare(u.title);if(N==="modified"){const C=c.modifiedAt||c.updatedAt||c.createdAt||c.timestamp||c.id,P=u.modifiedAt||u.updatedAt||u.createdAt||u.timestamp||u.id;if(typeof C=="string"&&typeof P=="string")return P.localeCompare(C);const w=new Date(C),k=new Date(P);return!isNaN(w.getTime())&&!isNaN(k.getTime())?k-w:String(P).localeCompare(String(C))}return 0}),[t,N]),x=s=>{p(c=>c.includes(s)?c.filter(u=>u!==s):[...c,s])},v=()=>{p(g?[]:l.map(s=>s.id))},g=l.length>0&&f.length===l.length,y=a==="Trash";return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 p-3 md:p-4 border-b border-solid border-border",children:[e.jsxs(z,{variant:"default",size:"default",onClick:h,className:"flex items-center gap-2 text-xs sm:text-sm px-3 py-2",children:[e.jsx(me,{size:14,className:"sm:w-4 sm:h-4"})," Back to Tags"]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 flex-wrap w-full sm:w-auto",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-foreground",children:a}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{size:16,className:"text-muted-foreground hidden sm:inline"}),e.jsxs(ie,{value:N,onValueChange:o,children:[e.jsx(oe,{className:"w-[120px] sm:w-36 h-8 text-xs sm:text-sm bg-secondary/50 border-border rounded-full",children:e.jsx(ce,{placeholder:"Sort by..."})}),e.jsxs(de,{children:[e.jsx(G,{value:"modified",children:"By Modified"}),e.jsx(G,{value:"name",children:"By Name"})]})]})]})]})]}),l.length>0&&e.jsxs("div",{className:"mx-2 sm:mx-4 mt-3 sm:mt-4 p-3 sm:p-4 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-4 h-4 rounded border-2 flex items-center justify-center transition-colors cursor-pointer select-none ${g?"bg-blue-500 border-blue-500":"border-gray-400 bg-transparent"}`,onClick:v,children:g&&e.jsx("svg",{className:"w-2.5 h-2.5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("label",{className:"text-sm sm:text-base font-medium text-foreground cursor-pointer select-none",onClick:v,children:"Select All"})]}),f.length>0&&e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-wrap",children:[e.jsxs("span",{className:"text-sm text-muted-foreground font-medium",children:[f.length," selected"]}),y?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{variant:"outline",size:"sm",onClick:()=>{n("restore",f)},children:[e.jsx(ze,{size:16,className:"mr-1"}),"Restore"]}),e.jsxs(z,{variant:"destructive",size:"sm",onClick:()=>{n("delete_permanently",f)},children:[e.jsx(R,{size:16,className:"mr-1"}),"Delete Permanently"]})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{variant:"outline",size:"sm",onClick:()=>{n("favorite",f)},className:"bg-secondary/50",children:[e.jsx(Q,{size:16,className:"mr-1"}),"Favorite"]}),e.jsxs(z,{variant:"outline",size:"sm",onClick:()=>{n("trash",f)},className:"bg-secondary/50",children:[e.jsx(R,{size:16,className:"mr-1"}),"Move to Trash"]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4 custom-scrollbar",children:e.jsxs("div",{className:"space-y-2",children:[l.map(s=>e.jsx(He,{chat:s,collections:r,isSelected:f.includes(s.id),onToggleSelection:x,onEdit:d,onToggleFavorite:i,onOpenChat:b},s.id)),l.length===0&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground text-sm",children:"No items found in this view."})})]})})]})}function I({type:t="text",value:r,onChange:a,placeholder:n,icon:h,className:d,...i}){return h?e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",children:h}),e.jsx(B,{type:t,value:r,onChange:a,placeholder:n,className:L("pl-10",d),...i})]}):e.jsx(B,{type:t,value:r,onChange:a,placeholder:n,className:d,...i})}function Ge({onBack:t,settings:r,onSaveSettings:a,searchQuery:n=""}){const[h,d]=m.useState([]),[i,b]=m.useState(null),[f,p]=m.useState(!1),N=h.filter(s=>{if(!n)return!0;const c=n.toLowerCase();return s.name.toLowerCase().includes(c)||s.urlPattern.toLowerCase().includes(c)||s.titlePrefix&&s.titlePrefix.toLowerCase().includes(c)||s.notePrefix&&s.notePrefix.toLowerCase().includes(c)});m.useEffect(()=>{r!=null&&r.aiPlatforms?d(r.aiPlatforms):d([{id:"gemini",name:"Gemini",urlPattern:"https://gemini.google.com/",titlePrefix:"Gemini-",notePrefix:"Gemini chat for",isDefault:!0},{id:"chatgpt",name:"ChatGPT",urlPattern:"https://chatgpt.com/",titlePrefix:"ChatGPT-",notePrefix:"ChatGPT chat for",isDefault:!0},{id:"claude",name:"Claude",urlPattern:"https://claude.ai/",titlePrefix:"Claude-",notePrefix:"Claude chat for",isDefault:!0},{id:"perplexity",name:"Perplexity",urlPattern:"https://www.perplexity.ai/",titlePrefix:"Perplexity-",notePrefix:"Perplexity chat for",isDefault:!0}])},[r]);const o=()=>{b({id:`custom_${Date.now()}`,name:"",urlPattern:"",titlePrefix:"",notePrefix:"",isDefault:!1}),p(!0)},l=s=>{b({...s}),p(!1)},x=()=>{if(!i.name.trim()||!i.urlPattern.trim()){alert("Platform name and URL pattern are required.");return}let s;f?s=[...h,i]:s=h.map(u=>u.id===i.id?i:u),d(s);const c={...r,aiPlatforms:s};a(c),b(null),p(!1)},v=s=>{const c=h.find(u=>u.id===s);if(c!=null&&c.isDefault){alert("Cannot delete default platforms.");return}if(confirm("Are you sure you want to delete this platform?")){const u=h.filter(P=>P.id!==s);d(u);const C={...r,aiPlatforms:u};a(C)}},g=()=>{b(null),p(!1)},y=async()=>{if(confirm("Are you sure you want to sign out? This will close the manager."))try{await we(),window.close()}catch(s){console.error("Sign-out failed:",s),alert("Failed to sign out. Please try again.")}};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 p-3 md:p-4 border-b border-solid border-border",children:[e.jsxs(z,{variant:"ghost",onClick:t,className:"flex items-center gap-2 px-3 py-2 text-xs sm:text-sm bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(me,{size:14,className:"sm:w-4 sm:h-4"})," Back to Collections"]}),e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-foreground",children:"Settings"})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-3 md:p-4 space-y-4 md:space-y-6 custom-scrollbar",children:[e.jsxs("div",{className:"bg-zinc-800/50 backdrop-blur-sm rounded-lg",children:[e.jsx("div",{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm sm:text-base font-medium text-foreground",children:"AI Chat Platforms"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mt-1",children:"Configure URL patterns and default titles/notes for AI chat platforms."})]}),e.jsxs(z,{onClick:o,className:"flex items-center gap-2 px-3 py-2 text-xs sm:text-sm bg-green-600 hover:bg-green-700 text-white w-full sm:w-auto",children:[e.jsx(K,{size:14,className:"sm:w-4 sm:h-4"})," Add Platform"]})]})}),e.jsx("div",{className:"p-4 space-y-3",children:N.length>0?N.map(s=>e.jsx("div",{className:"bg-card/30 rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground",style:{fontSize:"15px"},children:s.name}),s.isDefault&&e.jsx(O,{variant:"secondary",className:"text-xs",children:"Default"})]}),e.jsx("p",{className:"text-sm text-muted-foreground font-mono mb-2",children:s.urlPattern}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[s.titlePrefix&&e.jsxs(O,{variant:"outline",className:"text-xs",children:['Title: "',s.titlePrefix,'"']}),s.notePrefix&&e.jsxs(O,{variant:"outline",className:"text-xs",children:['Note: "',s.notePrefix,'"']})]})]}),e.jsxs("div",{className:"flex gap-1 ml-4",children:[e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>l(s),className:"p-2 hover:bg-gray-700",children:e.jsx(U,{size:16})}),!s.isDefault&&e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>v(s.id),className:"p-2 text-red-500 hover:text-red-600 hover:bg-red-500/10",children:e.jsx(R,{size:16})})]})]})},s.id)):n?e.jsx("div",{className:"text-center py-8",children:e.jsxs("p",{className:"text-muted-foreground text-sm",children:['No settings found for "',n,'"']})}):null})]}),e.jsxs("div",{className:"bg-zinc-800/50 backdrop-blur-sm rounded-lg",children:[e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-base font-medium text-foreground",children:"Account"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage your Google Drive account and data synchronization."})]}),e.jsx("div",{className:"p-4",children:e.jsxs(z,{variant:"destructive",onClick:y,className:"flex items-center gap-2 px-3 py-2 bg-red-600 hover:bg-red-700 text-white",children:[e.jsx(Fe,{size:16})," Sign Out"]})})]})]}),e.jsx($,{open:!!i,onOpenChange:s=>!s&&g(),children:e.jsxs(V,{className:"sm:max-w-[425px] bg-zinc-800/95 border-gray-700",children:[e.jsx(_,{children:e.jsx(q,{className:"text-foreground",children:f?"Add New Platform":"Edit Platform"})}),i&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Platform Name *"}),e.jsx(I,{value:i.name,onChange:s=>b({...i,name:s.target.value}),placeholder:"e.g., Custom AI",className:"bg-black/30 border-gray-700 focus:bg-black/20 focus:border-gray-600 text-white placeholder:text-gray-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"URL Pattern *"}),e.jsx(I,{value:i.urlPattern,onChange:s=>b({...i,urlPattern:s.target.value}),placeholder:"e.g., https://example.com/",className:"bg-black/30 border-gray-700 focus:bg-black/20 focus:border-gray-600 text-white placeholder:text-gray-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Default Title Prefix (optional)"}),e.jsx(I,{value:i.titlePrefix,onChange:s=>b({...i,titlePrefix:s.target.value}),placeholder:"e.g., CustomAI-",className:"bg-black/30 border-gray-700 focus:bg-black/20 focus:border-gray-600 text-white placeholder:text-gray-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Default Note Prefix (optional)"}),e.jsx(I,{value:i.notePrefix,onChange:s=>b({...i,notePrefix:s.target.value}),placeholder:"e.g., CustomAI chat for",className:"bg-black/30 border-gray-700 focus:bg-black/20 focus:border-gray-600 text-white placeholder:text-gray-500"})]})]}),e.jsxs(H,{children:[e.jsx(z,{variant:"outline",onClick:g,className:"px-3 py-2 bg-black/30 border-gray-700 text-white hover:bg-black/20",children:"Cancel"}),e.jsx(z,{onClick:x,className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white",children:f?"Add Platform":"Save Changes"})]})]})})]})}function Ke({isOpen:t,onClose:r,onSave:a}){const[n,h]=m.useState(""),[d,i]=m.useState(!1),b=async()=>{if(n.trim()){i(!0);try{await a(n.trim()),h(""),r()}catch(p){alert(p.message)}finally{i(!1)}}},f=p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),b())};return e.jsx($,{open:t,onOpenChange:p=>!p&&r(),children:e.jsxs(V,{className:"sm:max-w-[425px] bg-zinc-800/95 border-gray-700",children:[e.jsx(_,{children:e.jsxs(q,{className:"flex items-center gap-2 text-foreground",children:[e.jsx(K,{className:"h-5 w-5"}),"Create New Tag"]})}),e.jsx("div",{className:"py-4 space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Tag Name"}),e.jsx(B,{value:n,onChange:p=>h(p.target.value),onKeyPress:f,placeholder:"Enter tag name...",autoFocus:!0,className:"bg-black/30 border-gray-700 focus:bg-black/20 focus:border-gray-600 text-white placeholder:text-gray-500"})]})}),e.jsxs(H,{className:"flex gap-2",children:[e.jsx(F,{variant:"outline",onClick:r,disabled:d,className:"bg-black/30 hover:bg-black/20 text-white border-gray-700",children:"Cancel"}),e.jsx(F,{onClick:b,disabled:!n.trim()||d,className:"bg-blue-600 hover:bg-blue-700 text-white",children:d?"Creating...":"Create Tag"})]})]})})}function Ue({isOpen:t,onClose:r,onSave:a,collection:n}){const[h,d]=m.useState("");m.useEffect(()=>{n&&d(n.name||"")},[n]);const i=async()=>{if(!(!h.trim()||h.trim()===(n==null?void 0:n.name)))try{const f={...n,name:h.trim(),dateModified:new Date().toISOString()};await a(f)}catch(f){alert(f.message||"Failed to rename tag. Please try again.")}},b=f=>{f.key==="Enter"&&(f.preventDefault(),i())};return e.jsx($,{open:t,onOpenChange:f=>!f&&r(),children:e.jsxs(V,{className:"sm:max-w-[425px] bg-zinc-800/95 border-gray-700",children:[e.jsx(_,{children:e.jsxs(q,{className:"flex items-center gap-2 text-foreground",children:[e.jsx(U,{className:"h-5 w-5"}),"Rename Tag"]})}),e.jsx("div",{className:"py-4 space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Tag Name"}),e.jsx(B,{value:h,onChange:f=>d(f.target.value),onKeyPress:b,placeholder:"e.g., Project X",autoFocus:!0,className:"bg-black/30 border-gray-700 focus:bg-black/20 focus:border-gray-600 text-white placeholder:text-gray-500"})]})}),e.jsxs(H,{className:"flex gap-2",children:[e.jsx(F,{variant:"outline",onClick:r,className:"bg-black/30 hover:bg-black/20 text-white border-gray-700",children:"Cancel"}),e.jsx(F,{onClick:i,disabled:!h.trim()||h.trim()===(n==null?void 0:n.name),className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Rename Tag"})]})]})})}function Qe({collections:t,selectedIds:r,onToggleCollection:a}){return e.jsxs("div",{className:"space-y-1 max-h-32 overflow-y-auto custom-scrollbar border border-gray-700 rounded-md p-2",children:[t.map(n=>{const h=r.includes(n.id);return e.jsx("div",{onClick:()=>a(n.id),className:L("flex items-center justify-between p-2 rounded cursor-pointer transition-all duration-200",h?"bg-primary/20 border border-primary text-primary-foreground":"bg-card border-border hover:bg-accent hover:border-accent-foreground"),children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:L("w-4 h-4 rounded border-2 flex items-center justify-center transition-colors",h?"bg-blue-600 border-blue-600":"border-gray-500 hover:border-gray-400"),children:h&&e.jsx("svg",{className:"w-2.5 h-2.5 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:n.name}),e.jsxs("div",{className:"flex items-center space-x-1",children:[n.isPinned&&e.jsx(ne,{size:12,filled:!0,className:"text-blue-400"}),n.isFavorite&&e.jsx("div",{className:"w-1.5 h-1.5 bg-yellow-500 rounded-full",title:"Favorite"})]})]})]}),e.jsx(O,{variant:"secondary",className:"text-xs",children:n.chatCount||0})]})},n.id)}),t.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-2",children:"No tags available"})]})}function We({isOpen:t,onClose:r,onSave:a,chat:n,allCollections:h=[],onCreateCollection:d}){const[i,b]=m.useState(""),[f,p]=m.useState(""),[N,o]=m.useState([]),[l,x]=m.useState(!1),[v,g]=m.useState(""),[y,s]=m.useState(!1);m.useEffect(()=>{n?(b(n.title||""),p(n.note||""),o(n.collectionIds||[])):(b(""),p(""),o([]))},[n]);const c=()=>{if(!i.trim()){alert("Please enter a title for the chat.");return}const w={...n,title:i.trim(),note:f.trim(),collectionIds:N};a(w),r()},u=async()=>{if(v.trim()){s(!0);try{const w=await d(v.trim());o(k=>[...k,w.id]),g(""),x(!1)}catch(w){alert(w.message)}finally{s(!1)}}},C=w=>{o(k=>k.includes(w)?k.filter(T=>T!==w):[...k,w])},P=[...h].sort((w,k)=>w.isPinned&&!k.isPinned?-1:!w.isPinned&&k.isPinned?1:w.isFavorite&&!k.isFavorite?-1:!w.isFavorite&&k.isFavorite?1:w.name.localeCompare(k.name));return e.jsx($,{open:t,onOpenChange:w=>!w&&r(),children:e.jsxs(V,{className:"sm:max-w-[420px] bg-zinc-800/95 border-gray-700",children:[e.jsx(_,{children:e.jsx(q,{className:"text-foreground",children:"Edit Chat"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Title"}),e.jsx(B,{value:i,onChange:w=>b(w.target.value),placeholder:"Enter chat title...",className:"bg-black/30 border-gray-700 focus:bg-black/20 focus:border-gray-600 text-white placeholder:text-gray-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Note"}),e.jsx("textarea",{value:f,onChange:w=>p(w.target.value),placeholder:"Add a note (optional)...",rows:3,className:"w-full px-3 py-2 bg-black/30 border border-gray-700 rounded-xl text-white placeholder:text-gray-500 text-sm focus:outline-none focus:bg-black/20 focus:border-gray-600 resize-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Tags"}),e.jsxs(F,{variant:"ghost",size:"sm",onClick:()=>x(!l),className:"text-xs text-green-500 hover:text-green-400",children:[e.jsx(K,{className:"h-3 w-3 mr-1"}),"Add New"]})]}),l&&e.jsxs("div",{className:"flex gap-2 p-3 bg-zinc-900/50 rounded-lg border border-gray-700",children:[e.jsx(B,{value:v,onChange:w=>g(w.target.value),placeholder:"Tag name...",disabled:y,className:"flex-1 bg-black/30 border-gray-700 focus:bg-black/20 focus:border-gray-600 text-white placeholder:text-gray-500 text-sm",onKeyPress:w=>{w.key==="Enter"&&!y&&u()}}),e.jsx(F,{onClick:u,size:"sm",disabled:!v.trim()||y,className:"px-3 py-1 h-8 bg-green-600 hover:bg-green-700 text-white text-xs disabled:opacity-50 disabled:cursor-not-allowed",children:y?"Adding...":"Add"})]}),e.jsx(Qe,{collections:P,selectedIds:N,onToggleCollection:C})]})]}),e.jsxs(H,{className:"flex gap-2",children:[e.jsx(F,{variant:"outline",onClick:r,className:"bg-black/30 hover:bg-black/20 text-white border-gray-700",children:"Cancel"}),e.jsx(F,{onClick:c,className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Save Changes"})]})]})})}function re({isOpen:t,onClose:r,onConfirm:a,title:n,children:h}){const d=r===a;return e.jsx($,{open:t,onOpenChange:i=>!i&&r(),children:e.jsxs(V,{className:"sm:max-w-[425px] bg-zinc-800/95 border-gray-700",children:[e.jsx(_,{children:e.jsx(q,{className:"text-foreground",children:n})}),e.jsx("div",{className:"py-4",children:e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:h})}),e.jsxs(H,{className:`flex gap-2 ${d?"justify-center":"justify-end"}`,children:[!d&&e.jsx(F,{variant:"outline",onClick:r,className:"bg-black/30 hover:bg-black/20 text-white border-gray-700",children:"Cancel"}),e.jsx(F,{variant:d?"default":"destructive",onClick:a,className:d?"bg-blue-600 hover:bg-blue-700 text-white":"",children:d?"OK":"Confirm"})]})]})})}function Xe({modals:t,alertModal:r,appData:a,onCloseModal:n,onCreateCollection:h,onEditCollection:d,onSaveChatChanges:i,onCloseAlert:b,onConfirmDelete:f}){var p,N,o,l,x,v,g,y,s,c,u,C;return e.jsxs(e.Fragment,{children:[e.jsx(Ke,{isOpen:t.createCollection,onClose:()=>n("createCollection"),onSave:h}),e.jsx(Ue,{isOpen:!!t.editCollection,onClose:()=>n("editCollection"),onSave:d,collection:t.editCollection}),e.jsx(We,{isOpen:!!t.editChat,onClose:()=>n("editChat"),onSave:i,chat:t.editChat,allCollections:a.collections.filter(P=>!P.isDeleted),onCreateCollection:h}),e.jsx(re,{isOpen:!!t.confirm,onClose:()=>n("confirm"),onConfirm:f,title:((p=t.confirm)==null?void 0:p.type)==="collection_trash"?"Delete Tag":(o=(N=t.confirm)==null?void 0:N.type)!=null&&o.includes("permanent")?"Permanently Delete":(x=(l=t.confirm)==null?void 0:l.type)!=null&&x.includes("trash")?"Move to Trash":"Confirm Action",children:t.confirm&&e.jsxs(e.Fragment,{children:[t.confirm.type==="collection_trash"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm",children:"Are you sure you want to delete this tag?"}),e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-blue-300 mb-2 font-medium",children:"ℹ️ What happens when you delete:"}),e.jsxs("ul",{className:"text-xs text-muted-foreground space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"The tag will be deleted"}),e.jsx("li",{children:"Chats with this tag will NOT be deleted"}),e.jsx("li",{children:'Chats will remain in "All Chats" but lose this tag'})]})]})]}),((g=(v=t.confirm)==null?void 0:v.type)==null?void 0:g.includes("permanent"))&&((y=t.confirm)==null?void 0:y.type)!=="collection_trash"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mb-2",children:["Are you sure you want to permanently delete"," ",e.jsx("strong",{children:t.confirm.count||1})," item(s)?"]}),e.jsx("p",{className:"text-red-400 text-xs",children:"This action cannot be undone!"})]}),((s=t.confirm.type)==null?void 0:s.includes("trash"))&&!((c=t.confirm.type)!=null&&c.includes("permanent"))&&t.confirm.type!=="collection_trash"&&e.jsxs("p",{children:["Are you sure you want to move"," ",e.jsx("strong",{children:t.confirm.count||1})," item(s) to trash?"]}),!((u=t.confirm.type)!=null&&u.includes("permanent"))&&!((C=t.confirm.type)!=null&&C.includes("trash"))&&e.jsxs("p",{children:["Are you sure you want to perform this action on"," ",e.jsx("strong",{children:t.confirm.count||1})," item(s)?"]})]})}),e.jsx(re,{isOpen:!!r,onClose:b,onConfirm:b,title:(r==null?void 0:r.title)||"Alert",children:r==null?void 0:r.message})]})}function Ye(){const[t,r]=m.useState(!1),{appData:a,isLoading:n,updateAppData:h}=Ae(),{currentView:d,setCurrentView:i,filteredChats:b,setFilteredChats:f,viewTitle:p,setViewTitle:N,searchQuery:o,setSearchQuery:l,isSearchFocused:x,setIsSearchFocused:v,modals:g,alertModal:y,setAlertModal:s,isProcessing:c,setIsProcessing:u,openModal:C,closeModal:P,showAlert:w}=De(),k=Oe(a,h,w,C,P),T=Be(a,h,w,C,P,f,u),A=m.useMemo(()=>{let j=a.collections.filter(S=>!S.isDeleted);return o&&d==="collections"&&(j=j.filter(S=>S.name.toLowerCase().includes(o.toLowerCase()))),ue(j)},[a.collections,o,d]),D=m.useMemo(()=>{let j=b;return o&&d==="allChats"&&(j=b.filter(S=>{var ee;const X=S.title.toLowerCase().includes(o),ye=(ee=S.note)==null?void 0:ee.toLowerCase().includes(o),be=S.collectionIds.some(pe=>{var te;return(te=a.collections.find(ve=>ve.id===pe))==null?void 0:te.name.toLowerCase().includes(o)});return X||ye||be})),M(j)},[a.chats,a.collections,o,b]),W=m.useCallback(j=>{i(j),j==="collections"?(N("Tags"),f([])):j==="allChats"?(N("All Chats"),f(a.chats.filter(S=>!S.isDeleted))):j==="settings"&&(N("Settings"),f([]))},[a.chats,i,N,f]),Y=m.useCallback(j=>{const S=k.handleSelectCollection(j);S.view==="settings"?(i("settings"),N("Settings")):(N(S.title),f(M(S.chats)),i("allChats"))},[k,i,N,f]),J=m.useCallback(()=>{i("collections"),N("Tags"),f([])},[i,N,f]),he=m.useCallback((j,S)=>{j==="trash"||j==="delete_permanently"?C("confirm",{type:`bulk_${j}`,ids:S,count:S.length}):T.handleBulkAction(j,S)},[C,T]),fe=m.useCallback(async()=>{const j=g.confirm;if(j){P("confirm"),u(!0);try{switch(j.type){case"collection_trash":await k.handleDeleteCollection(j.id);break;case"chat_trash":await T.handleDeleteChat(j.id);break;case"chat_permanent":await T.handleDeleteChatPermanently(j.id);break;case"bulk_trash":await T.handleBulkAction("trash",j.ids);break;case"bulk_delete_permanently":await T.handleBulkAction("delete_permanently",j.ids);break;case"bulk_restore":await T.handleBulkAction("restore",j.ids);break;default:console.warn("Unknown delete type:",j.type)}}catch(S){console.error("Delete operation failed:",S),w("Error","Failed to complete the operation. Please try again.")}finally{u(!1)}}},[g.confirm,k,T,P,w,u]),Z=m.useMemo(()=>Re(j=>{l(j.toLowerCase().trim())},300),[l]),ge=m.useCallback(j=>{Z(j)},[Z]);return n?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx(se,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("div",{className:"text-foreground",children:"Loading your data..."})]})}):e.jsxs("div",{className:"flex h-screen bg-background",children:[e.jsx(Ve,{currentView:d,onViewChange:W,onSelectCollection:Y,viewTitle:p,isMobileOpen:t,onMobileClose:()=>r(!1)}),e.jsx("main",{className:"flex-1 flex flex-col justify-start overflow-hidden bg-background px-4 md:px-8 py-4 md:py-6 h-full w-full",children:e.jsxs("div",{className:"max-w-5xl mx-auto w-full flex flex-col h-full",children:[e.jsx($e,{onSearch:ge,isSearchFocused:x,onFocusChange:v,onMobileMenuClick:()=>r(!0)}),e.jsx("div",{className:"flex-1 bg-card/50 rounded-xl p-3 md:p-6 shadow-sm overflow-hidden",children:d==="collections"?e.jsx(qe,{collections:A,chats:a.chats,onSelectCollection:Y,onCreateCollection:()=>C("createCollection"),onEditCollection:j=>{const S=a.collections.find(X=>X.id===j);C("editCollection",S)},onDeleteCollection:j=>C("confirm",{type:"collection_trash",id:j}),onToggleFavoriteCollection:k.handleToggleFavoriteCollection,onTogglePinCollection:k.handleTogglePinCollection,searchQuery:o}):d==="settings"?e.jsx(Ge,{onBack:J,settings:a.settings||{},onSaveSettings:j=>{h({...a,settings:{...a.settings,...j}})},searchQuery:o}):e.jsx(Ie,{chats:D,collections:a.collections.filter(j=>!j.isDeleted),viewTitle:o?`Search results for "${o}"`:p,onBack:J,onBulkAction:he,onEdit:T.handleEditChat,onToggleFavorite:T.handleToggleFavorite,onOpenChat:T.handleOpenChat})})]})}),e.jsx(Xe,{modals:g,alertModal:y,appData:a,onCloseModal:P,onCreateCollection:k.handleCreateCollection,onEditCollection:k.handleEditCollection,onSaveChatChanges:T.handleSaveChatChanges,onCloseAlert:()=>s(null),onConfirmDelete:fe}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[100]",children:e.jsxs("div",{className:"bg-card/95 rounded-xl shadow-2xl border border-border/50 flex flex-col items-center gap-4 w-full max-w-[425px] p-6",children:[e.jsx(se,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("div",{className:"text-foreground font-medium text-center",children:"Processing..."}),e.jsx("div",{className:"text-sm text-muted-foreground text-center",children:"Please wait while we update your data"})]})})]})}document.documentElement.classList.add("dark");ke.createRoot(document.getElementById("root")).render(e.jsx(Pe.StrictMode,{children:e.jsx(Ye,{})}));
