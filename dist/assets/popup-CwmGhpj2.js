import{c as Y,r as o,j as e,B as P,I as U,P as W,L as J,R as B,a as G,b as V,C as F,d as z,e as Q,f as _,g as Z,h as q,s as T,i as K,k as ee}from"./global-BjklyNvB.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=Y("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);function te({onSave:v,onOpenManager:i,allCollections:y=[],currentTab:h,aiPlatforms:C=[],onCreateCollection:j}){const[c,w]=o.useState(""),[d,x]=o.useState(""),[u,m]=o.useState([]),[k,f]=o.useState(!1),[S,g]=o.useState(""),[I,E]=o.useState(!1);o.useEffect(()=>{if(!h||!h.url)return;const s=C.find(l=>h.url.startsWith(l.urlPattern));s&&(w(s.titlePrefix||""),x(s.notePrefix||""))},[h,C]);const L=async()=>{if(!c.trim()){alert("Please enter a title for the chat.");return}E(!0);try{const s={id:`chat_${Date.now()}`,title:c.trim(),url:h.url,note:d.trim(),collectionIds:u,createdAt:new Date().toISOString(),isFavorite:!1,isDeleted:!1};await v(s),w(""),x(""),m([]),f(!1),g("")}catch(s){console.error("Failed to save chat:",s),alert("Failed to save chat. Please try again.")}finally{E(!1)}},D=()=>{w(""),x(""),m([]),f(!1),g("")},A=async()=>{if(!S.trim()){alert("Please enter a collection name.");return}try{if(j){const s=await j(S.trim());m(l=>[...l,s.id])}g(""),f(!1)}catch(s){alert(s.message||"Failed to create collection.")}};return e.jsxs("div",{className:"px-4 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground bg-zinc-800/30 backdrop-blur-sm rounded-tl-lg rounded-tr-lg  pt-1 pb-1 pl-2 pr-4",children:"Save Chat"}),e.jsxs(P,{variant:"ghost",size:"sm",onClick:i,className:"px-2 pb-1 pt-1 flex items-center bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Manager"]})]}),e.jsx("div",{className:"max-w-sm mx-auto px-4 bg-zinc-800/30 backdrop-blur-sm rounded-tr-lg rounded-br-lg rounded-bl-lg",children:e.jsxs("div",{className:" p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block text-foreground",children:"Title"}),e.jsx(U,{value:c,onChange:s=>w(s.target.value),placeholder:"Enter chat title...",className:"w-full bg-black/30 border-gray-700 focus:bg-black/20 focus:border-gray-600 text-white placeholder:text-gray-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block text-foreground",children:"Note (optional)"}),e.jsx(U,{value:d,onChange:s=>x(s.target.value),placeholder:"Add a note...",className:"w-full bg-black/30 border-gray-700 focus:bg-black/20 focus:border-gray-600 text-white placeholder:text-gray-500"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Tags"}),e.jsxs(P,{variant:"ghost",size:"sm",onClick:()=>f(!k),className:"px-2 py-1 h-6 text-xs bg-green-600/20 hover:bg-green-600/30 text-green-400 border border-green-600/50",children:[e.jsx(W,{className:"h-3 w-3 mr-1"}),"Add New"]})]}),k&&e.jsxs("div",{className:"mb-2 flex space-x-2",children:[e.jsx(U,{value:S,onChange:s=>g(s.target.value),placeholder:"Enter collection name...",className:"flex-1 bg-black/30 border-gray-700 focus:bg-black/20 focus:border-gray-600 text-white placeholder:text-gray-500 text-sm",onKeyPress:s=>{s.key==="Enter"&&A()}}),e.jsx(P,{onClick:A,size:"sm",className:"px-3 py-1 h-8 bg-green-600 hover:bg-green-700 text-white text-xs",children:"Add"})]}),e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto custom-scrollbar",children:y.sort((s,l)=>s.isPinned&&!l.isPinned?-1:!s.isPinned&&l.isPinned?1:s.isFavorite&&!l.isFavorite?-1:!s.isFavorite&&l.isFavorite?1:s.name.localeCompare(l.name)).map(s=>e.jsx("div",{className:`p-2 rounded-md cursor-pointer transition-colors flex items-center justify-between select-none ${u.includes(s.id)?"bg-blue-500/20 border border-blue-500":"bg-secondary/50 hover:bg-secondary"}`,onClick:()=>{m(l=>l.includes(s.id)?l.filter(M=>M!==s.id):[...l,s.id])},children:e.jsxs("div",{className:"flex items-center space-x-3 select-none",children:[e.jsx("div",{className:`w-4 h-4 rounded border-2 flex items-center justify-center transition-colors cursor-pointer select-none ${u.includes(s.id)?"bg-blue-500 border-blue-500":"border-gray-400 bg-transparent"}`,children:u.includes(s.id)&&e.jsx("svg",{className:"w-2.5 h-2.5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"flex items-center space-x-2 select-none",children:[e.jsx("span",{className:"text-sm font-medium text-foreground select-none cursor-pointer",children:s.name}),(s.isPinned||s.isFavorite)&&e.jsxs("div",{className:"flex items-center space-x-1 select-none",children:[s.isPinned&&e.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full select-none",title:"Pinned"}),s.isFavorite&&e.jsx("div",{className:"w-1.5 h-1.5 bg-yellow-500 rounded-full select-none",title:"Favorite"})]})]})]})},s.id))})]}),e.jsxs("div",{className:"flex space-x-2 pt-2",children:[e.jsx(P,{variant:"outline",onClick:D,className:"flex-1 px-3 py-1.5 h-8 bg-black/30 border-gray-700 text-white hover:bg-black/20 text-sm",children:"Cancel"}),e.jsx(P,{onClick:L,disabled:I,className:"flex-1 px-3 py-1.5 h-8 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white text-sm",children:I?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-3.5 w-3.5 mr-1.5 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"h-3.5 w-3.5 mr-1.5"}),"Save Chat"]})})]})]})})]})}function se(){var O;const[v,i]=o.useState(!1),[y,h]=o.useState(!0),[C,j]=o.useState(null),[c,w]=o.useState(null),[d,x]=o.useState({collections:[]}),[u,m]=o.useState(null),k=o.useRef(null),f=o.useRef(null);o.useEffect(()=>{(async()=>{try{const r=await Z();i(r);const a=await chrome.tabs.query({active:!0,currentWindow:!0});if(!a||a.length===0)throw new Error("Could not get current tab information.");if(w(a[0]),r){const n=await q();x(n)}}catch(r){console.error("Popup initialization failed:",r),j(r.message||"An unknown error occurred.")}finally{h(!1)}})()},[]),o.useEffect(()=>{if(u){const t=k.current||f.current;if(t){const r=t.getBoundingClientRect(),a=window.innerHeight;r.bottom>a&&t.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})}}},[u]);const S=async()=>{try{await T(),i(!0);const t=await q();x(t),j(null)}catch(t){console.error("Sign-in failed from popup:",t),j(t.message||"Sign-in failed or was cancelled.")}},g=()=>{chrome.tabs.create({url:chrome.runtime.getURL("manager.html")})},I=async t=>{const r={...d,chats:[...d.chats||[],t]};try{await K(r),window.close()}catch(a){console.error("Failed to save chat from popup:",a),alert("Error: Could not save the chat.")}},E=async t=>{if(d.collections.some(n=>!n.isDeleted&&n.name.toLowerCase()===t.toLowerCase()))throw new Error(`A collection named "${t}" already exists.`);const r={id:`col_${Date.now()}`,name:t,isPinned:!1,isFavorite:!1,isDeleted:!1,dateCreated:new Date().toISOString(),dateDeleted:null},a={...d,collections:[...d.collections,r].sort((n,N)=>n.name.localeCompare(N.name))};try{return await K(a),x(a),r}catch(n){throw console.error("Failed to create collection:",n),n}},L=(t,r=[])=>{if(!t)return!1;const a=["https://gemini.google.com/","https://chatgpt.com/","https://claude.ai/","https://www.perplexity.ai/"];return r.length>0?r.some(n=>t.startsWith(n.urlPattern)):a.some(n=>t.startsWith(n))},D=((O=d.settings)==null?void 0:O.aiPlatforms)||[],A=L(c==null?void 0:c.url,D),s=B.useMemo(()=>{var t,r,a;return((a=(r=(t=d.collections)==null?void 0:t.filter(n=>!n.isDeleted&&n.isPinned))==null?void 0:r.sort((n,N)=>new Date(N.dateCreated)-new Date(n.dateCreated)))==null?void 0:a.slice(0,3))||[]},[d.collections]),l=t=>{var r;return((r=d.chats)==null?void 0:r.filter(a=>!a.isDeleted&&a.collectionIds.includes(t)))||[]},M=t=>{if(c!=null&&c.url){const r=new URL(c.url),a=r.pathname.split("/"),n=a.findIndex(p=>p==="u");if(n!==-1&&a[n+1]){const p=a[n+1],$=new URL(t);let b=$.pathname;if(!b.includes("/u/"))return b.startsWith("/app/")?b=`/u/${p}${b}`:b=`/u/${p}${b}`,$.pathname=b,$.toString()}const N=r.searchParams.get("authuser");if(N){const p=new URL(t);return p.searchParams.set("authuser",N),p.toString()}}return t},H=t=>{const r=M(t);console.log("Original URL:",t),console.log("Current Tab URL:",c==null?void 0:c.url),console.log("Account-aware URL:",r),chrome.tabs.create({url:r}),window.close()},R="w-96 min-h-[200px] rounded-xl bg-background shadow-lg";return y?e.jsxs("div",{className:`${R} flex flex-col items-center justify-center p-6`,children:[e.jsx(J,{className:"h-8 w-8 animate-spin text-primary mb-3"}),e.jsx("div",{className:"text-foreground text-sm",children:"Loading AI Chat Manager..."})]}):C?e.jsx("div",{className:`${R} flex flex-col items-center justify-center p-6`,children:e.jsxs("div",{className:"text-red-500 text-sm text-center",children:[e.jsx("div",{className:"font-medium mb-2",children:"Error"}),e.jsx("div",{children:C})]})}):v?e.jsx("div",{className:R,children:A?e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(te,{onSave:I,onOpenManager:g,allCollections:d.collections.filter(t=>!t.isDeleted),currentTab:c,aiPlatforms:D,onCreateCollection:E,appData:d}),s.length>0&&e.jsxs("div",{className:"pt-2",children:[e.jsxs("h4",{className:"flex items-center justify-center gap-1 text-sm font-medium text-foreground mb-3",children:[e.jsx(V,{size:16,filled:!0,className:"text-blue-400"}),"Quick Access"]}),e.jsxs("div",{className:"flex justify-center gap-2 relative",onMouseLeave:()=>m(null),children:[s.map(t=>{const r=l(t.id),a=u===t.id;return e.jsxs(F,{className:"cursor-pointer hover:bg-accent/50 transition-colors w-24 h-16 flex-shrink-0 relative",onMouseEnter:()=>m(t.id),children:[e.jsxs(z,{className:"p-2 h-full flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-xs font-medium text-foreground truncate w-full text-center",children:t.name}),e.jsx(Q,{variant:"secondary",className:"text-[10px] px-1 py-0 mt-1",children:r.length})]}),a&&r.length>0&&e.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1/2",children:e.jsx(_,{className:"w-3 h-3 text-foreground bg-background rounded-full border border-border"})})]},t.id)}),u&&(()=>{const t=s.find(a=>a.id===u),r=t?l(t.id):[];return r.length>0&&e.jsx("div",{ref:k,className:"absolute top-full left-1/2 transform -translate-x-1/2 z-50 pt-2 w-72",onMouseEnter:()=>m(t.id),children:e.jsx(F,{className:"max-h-64 overflow-y-auto shadow-lg border",children:e.jsxs(z,{className:"p-2",children:[r.slice(0,10).map(a=>e.jsx("div",{className:"px-2 py-1 text-xs text-foreground hover:bg-accent rounded cursor-pointer truncate text-center",onClick:n=>{n.stopPropagation(),H(a.url)},title:`Click to open: ${a.title}`,children:a.title},a.id)),r.length>10&&e.jsxs("div",{className:"px-2 py-1 text-xs text-muted-foreground font-medium text-center",children:["+",r.length-10," more chats..."]})]})})})})()]})]})]}):e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-3",children:"AI Chat Manager"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Navigate to an AI chat page to save it."}),e.jsx("p",{className:"text-xs text-muted-foreground mb-4",children:"Supports: Gemini, ChatGPT, Claude, Perplexity"}),e.jsx("div",{className:"mb-6 flex justify-center",children:e.jsxs(G,{variant:"ghost",size:"sm",onClick:g,className:"px-2 pb-1 pt-1 flex items-center bg-blue-600 hover:bg-blue-700 text-white text-sm",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Manager"]})}),s.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"flex items-center justify-center gap-1 text-sm font-medium text-foreground mb-3",children:[e.jsx(V,{size:16,filled:!0,className:"text-blue-400"}),"Quick Access"]}),e.jsxs("div",{className:"flex justify-center gap-2 relative",onMouseLeave:()=>m(null),children:[s.map(t=>{const r=l(t.id),a=u===t.id;return e.jsxs(F,{className:"cursor-pointer hover:bg-accent/50 transition-colors w-24 h-16 flex-shrink-0 relative",onMouseEnter:()=>m(t.id),children:[e.jsxs(z,{className:"p-2 h-full flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-xs font-medium text-foreground truncate w-full text-center",children:t.name}),e.jsx(Q,{variant:"secondary",className:"text-[10px] px-1 py-0 mt-1",children:r.length})]}),a&&r.length>0&&e.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1/2",children:e.jsx(_,{className:"w-3 h-3 text-foreground bg-background rounded-full border border-border"})})]},t.id)}),u&&(()=>{const t=s.find(a=>a.id===u),r=t?l(t.id):[];return r.length>0&&e.jsx("div",{ref:f,className:"absolute top-full left-1/2 transform -translate-x-1/2 z-50 pt-2 w-72",onMouseEnter:()=>m(t.id),children:e.jsx(F,{className:"max-h-64 overflow-y-auto shadow-lg border",children:e.jsxs(z,{className:"p-2",children:[r.slice(0,10).map(a=>e.jsx("div",{className:"px-2 py-1 text-xs text-foreground hover:bg-accent rounded cursor-pointer truncate text-center",onClick:n=>{n.stopPropagation(),H(a.url)},title:`Click to open: ${a.title}`,children:a.title},a.id)),r.length>10&&e.jsxs("div",{className:"px-2 py-1 text-xs text-muted-foreground font-medium text-center",children:["+",r.length-10," more chats..."]})]})})})})()]})]})]})}):e.jsxs("div",{className:`${R} flex flex-col items-center justify-center p-6 text-center`,children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-3",children:"AI Chat Manager"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Please sign in to save and organize your AI chats."}),e.jsx(G,{onClick:S,className:"w-full",children:"Sign In with Google"})]})}class re extends B.Component{constructor(i){super(i),this.state={hasError:!1,error:null}}static getDerivedStateFromError(i){return{hasError:!0,error:i}}componentDidCatch(i,y){console.error("Error caught by boundary:",i,y)}render(){var i;return this.state.hasError?e.jsx("div",{className:"w-96 min-h-[200px] rounded-xl bg-background shadow-lg p-6 text-center",children:e.jsxs("div",{className:"text-red-500 text-sm",children:[e.jsx("div",{className:"font-medium mb-2",children:"Something went wrong"}),e.jsx("div",{className:"text-xs mb-4",children:((i=this.state.error)==null?void 0:i.message)||"An unexpected error occurred"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-primary text-primary-foreground rounded text-xs hover:bg-primary/90",children:"Refresh"})]})}):this.props.children}}function ae(){return e.jsx(re,{children:e.jsx(se,{})})}document.documentElement.classList.add("dark");try{console.log("Initializing React app..."),ee.createRoot(document.getElementById("root")).render(e.jsx(B.StrictMode,{children:e.jsx(ae,{})})),console.log("React app initialized successfully")}catch(v){console.error("Failed to initialize React app:",v);const i=document.getElementById("root");i&&(i.innerHTML=`
      <div style="
        width: 384px; 
        min-height: 200px; 
        padding: 24px; 
        background: #1f2937; 
        color: #f9fafb; 
        border-radius: 12px; 
        text-align: center;
        font-family: system-ui, -apple-system, sans-serif;
      ">
        <h3 style="color: #ef4444; margin-bottom: 16px;">Initialization Error</h3>
        <p style="font-size: 14px; margin-bottom: 16px;">Failed to load the extension</p>
        <button onclick="window.location.reload()" style="
          padding: 8px 16px; 
          background: #3b82f6; 
          color: white; 
          border: none; 
          border-radius: 6px; 
          cursor: pointer;
        ">
          Refresh
        </button>
      </div>
    `)}
